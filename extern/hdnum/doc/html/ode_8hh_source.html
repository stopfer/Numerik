<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Heidelberg Educational Numerics Library: src/ode.hh Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>src/ode.hh</h1><a href="ode_8hh.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// -*- tab-width: 4; indent-tabs-mode: nil -*-</span>
<a name="l00002"></a>00002 <span class="preprocessor">#ifndef HDNUM_ODE_HH</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor">#define HDNUM_ODE_HH</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span>
<a name="l00005"></a>00005 <span class="preprocessor">#include&lt;vector&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &quot;<a class="code" href="newton_8hh.html" title="Newton&amp;#39;s method with line search.">newton.hh</a>&quot;</span>
<a name="l00007"></a>00007 
<a name="l00012"></a>00012 <span class="keyword">namespace </span>hdnum {
<a name="l00013"></a>00013 
<a name="l00022"></a>00022   <span class="keyword">template</span>&lt;<span class="keyword">class</span> M&gt;
<a name="l00023"></a><a class="code" href="classhdnum_1_1EE.html">00023</a>   <span class="keyword">class </span><a class="code" href="classhdnum_1_1EE.html" title="Explicit Euler method as an example for an ODE solver.">EE</a>
<a name="l00024"></a>00024   {
<a name="l00025"></a>00025   <span class="keyword">public</span>:
<a name="l00027"></a><a class="code" href="classhdnum_1_1EE.html#a633508b18536c883d9fbbcccb7ac7ebc">00027</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::size_type <a class="code" href="classhdnum_1_1EE.html#a633508b18536c883d9fbbcccb7ac7ebc" title="export size_type">size_type</a>;
<a name="l00028"></a>00028 
<a name="l00030"></a><a class="code" href="classhdnum_1_1EE.html#a812a3ec962aa0b2924e30830828bf306">00030</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::time_type <a class="code" href="classhdnum_1_1EE.html#a812a3ec962aa0b2924e30830828bf306" title="export time_type">time_type</a>;
<a name="l00031"></a>00031 
<a name="l00033"></a><a class="code" href="classhdnum_1_1EE.html#a1ef3f42ee12273be741369aa6fd198cd">00033</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::number_type <a class="code" href="classhdnum_1_1EE.html#a1ef3f42ee12273be741369aa6fd198cd" title="export number_type">number_type</a>;
<a name="l00034"></a>00034 
<a name="l00036"></a><a class="code" href="classhdnum_1_1EE.html#a1121f4c7c4ba2baa9afefc19c1a4dbcf">00036</a>     <a class="code" href="classhdnum_1_1EE.html#a1121f4c7c4ba2baa9afefc19c1a4dbcf" title="constructor stores reference to the model">EE</a> (<span class="keyword">const</span> M&amp; model_)
<a name="l00037"></a>00037       : model(model_), u(model.size()), f(model.size())
<a name="l00038"></a>00038     {
<a name="l00039"></a>00039       model.initialize(t,u);
<a name="l00040"></a>00040       dt = 0.1; 
<a name="l00041"></a>00041     }
<a name="l00042"></a>00042 
<a name="l00044"></a><a class="code" href="classhdnum_1_1EE.html#a9da0d16e937e3b42bd4385c082909986">00044</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1EE.html#a9da0d16e937e3b42bd4385c082909986" title="set time step for subsequent steps">set_dt</a> (<a class="code" href="classhdnum_1_1EE.html#a812a3ec962aa0b2924e30830828bf306" title="export time_type">time_type</a> dt_)
<a name="l00045"></a>00045     {
<a name="l00046"></a>00046       dt = dt_;
<a name="l00047"></a>00047     }
<a name="l00048"></a>00048 
<a name="l00050"></a><a class="code" href="classhdnum_1_1EE.html#a6de0fb361be627ec08bceba734bf2971">00050</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1EE.html#a6de0fb361be627ec08bceba734bf2971" title="do one step">step</a> ()
<a name="l00051"></a>00051     {
<a name="l00052"></a>00052       model.f(t,u,f);   <span class="comment">// evaluate model</span>
<a name="l00053"></a>00053       u.update(dt,f);   <span class="comment">// advance state</span>
<a name="l00054"></a>00054       t += dt;          <span class="comment">// advance time</span>
<a name="l00055"></a>00055     }
<a name="l00056"></a>00056 
<a name="l00058"></a><a class="code" href="classhdnum_1_1EE.html#a9011390335a5c147590c55efb1200b80">00058</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1EE.html#a9011390335a5c147590c55efb1200b80" title="set current state">set_state</a> (<a class="code" href="classhdnum_1_1EE.html#a812a3ec962aa0b2924e30830828bf306" title="export time_type">time_type</a> t_, <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; u_)
<a name="l00059"></a>00059     {
<a name="l00060"></a>00060       t = t_;
<a name="l00061"></a>00061       u = u_;
<a name="l00062"></a>00062     }
<a name="l00063"></a>00063 
<a name="l00065"></a><a class="code" href="classhdnum_1_1EE.html#afeb12f7335aab6942ce190256c4982a5">00065</a>     <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; <a class="code" href="classhdnum_1_1EE.html#afeb12f7335aab6942ce190256c4982a5" title="get current state">get_state</a> ()<span class="keyword"> const</span>
<a name="l00066"></a>00066 <span class="keyword">    </span>{
<a name="l00067"></a>00067       <span class="keywordflow">return</span> u;
<a name="l00068"></a>00068     }
<a name="l00069"></a>00069 
<a name="l00071"></a><a class="code" href="classhdnum_1_1EE.html#a7c7ae19fc0aa93eac51497748f2101e2">00071</a>     <a class="code" href="classhdnum_1_1EE.html#a812a3ec962aa0b2924e30830828bf306" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1EE.html#a7c7ae19fc0aa93eac51497748f2101e2" title="get current time">get_time</a> ()<span class="keyword"> const</span>
<a name="l00072"></a>00072 <span class="keyword">    </span>{
<a name="l00073"></a>00073       <span class="keywordflow">return</span> t;
<a name="l00074"></a>00074     }
<a name="l00075"></a>00075 
<a name="l00077"></a><a class="code" href="classhdnum_1_1EE.html#a8aa4b8170705a377b04e3dd589c7d2d7">00077</a>     <a class="code" href="classhdnum_1_1EE.html#a812a3ec962aa0b2924e30830828bf306" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1EE.html#a8aa4b8170705a377b04e3dd589c7d2d7" title="get dt used in last step (i.e. to compute current state)">get_dt</a> ()<span class="keyword"> const</span>
<a name="l00078"></a>00078 <span class="keyword">    </span>{
<a name="l00079"></a>00079       <span class="keywordflow">return</span> dt;
<a name="l00080"></a>00080     }
<a name="l00081"></a>00081 
<a name="l00083"></a><a class="code" href="classhdnum_1_1EE.html#ab532f7b8db8f30ebac1712fcad3a2d0f">00083</a>     <a class="code" href="classhdnum_1_1EE.html#a633508b18536c883d9fbbcccb7ac7ebc" title="export size_type">size_type</a> <a class="code" href="classhdnum_1_1EE.html#ab532f7b8db8f30ebac1712fcad3a2d0f" title="return consistency order of the method">get_order</a> ()<span class="keyword"> const</span>
<a name="l00084"></a>00084 <span class="keyword">    </span>{
<a name="l00085"></a>00085       <span class="keywordflow">return</span> 1;
<a name="l00086"></a>00086     }
<a name="l00087"></a>00087     
<a name="l00088"></a>00088   <span class="keyword">private</span>:
<a name="l00089"></a>00089     <span class="keyword">const</span> M&amp; model;
<a name="l00090"></a>00090     <a class="code" href="classhdnum_1_1EE.html#a812a3ec962aa0b2924e30830828bf306" title="export time_type">time_type</a> t, dt;
<a name="l00091"></a>00091     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> u;
<a name="l00092"></a>00092     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> f;
<a name="l00093"></a>00093   };
<a name="l00094"></a>00094 
<a name="l00103"></a>00103   <span class="keyword">template</span>&lt;<span class="keyword">class</span> M&gt;
<a name="l00104"></a><a class="code" href="classhdnum_1_1ModifiedEuler.html">00104</a>   <span class="keyword">class </span><a class="code" href="classhdnum_1_1ModifiedEuler.html" title="Modified Euler method (order 2 with 2 stages).">ModifiedEuler</a>
<a name="l00105"></a>00105   {
<a name="l00106"></a>00106   <span class="keyword">public</span>:
<a name="l00108"></a><a class="code" href="classhdnum_1_1ModifiedEuler.html#aa8841e11397920c273afab1f9a04c9bd">00108</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::size_type <a class="code" href="classhdnum_1_1ModifiedEuler.html#aa8841e11397920c273afab1f9a04c9bd" title="export size_type">size_type</a>;
<a name="l00109"></a>00109 
<a name="l00111"></a><a class="code" href="classhdnum_1_1ModifiedEuler.html#a1c273cddcddf36f6e47f713080c06b41">00111</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::time_type <a class="code" href="classhdnum_1_1ModifiedEuler.html#a1c273cddcddf36f6e47f713080c06b41" title="export time_type">time_type</a>;
<a name="l00112"></a>00112 
<a name="l00114"></a><a class="code" href="classhdnum_1_1ModifiedEuler.html#abcfd3cb8a5b446f721582af3b170476e">00114</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::number_type <a class="code" href="classhdnum_1_1ModifiedEuler.html#abcfd3cb8a5b446f721582af3b170476e" title="export number_type">number_type</a>;
<a name="l00115"></a>00115 
<a name="l00117"></a><a class="code" href="classhdnum_1_1ModifiedEuler.html#ac7ad8c2a695fa27a8666dd4cd5a2e105">00117</a>     <a class="code" href="classhdnum_1_1ModifiedEuler.html#ac7ad8c2a695fa27a8666dd4cd5a2e105" title="constructor stores reference to the model">ModifiedEuler</a> (<span class="keyword">const</span> M&amp; model_)
<a name="l00118"></a>00118       : model(model_), u(model.size()), w(model.size()), k1(model.size()), k2(model.size())
<a name="l00119"></a>00119     {
<a name="l00120"></a>00120       c2 = 0.5;
<a name="l00121"></a>00121       a21 = 0.5;
<a name="l00122"></a>00122       b2 = 1.0;
<a name="l00123"></a>00123       model.initialize(t,u);
<a name="l00124"></a>00124       dt = 0.1; 
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126 
<a name="l00128"></a><a class="code" href="classhdnum_1_1ModifiedEuler.html#ad40c382bf56183ddb0a86e327d3ac7ac">00128</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1ModifiedEuler.html#ad40c382bf56183ddb0a86e327d3ac7ac" title="set time step for subsequent steps">set_dt</a> (<a class="code" href="classhdnum_1_1ModifiedEuler.html#a1c273cddcddf36f6e47f713080c06b41" title="export time_type">time_type</a> dt_)
<a name="l00129"></a>00129     {
<a name="l00130"></a>00130       dt = dt_;
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132 
<a name="l00134"></a><a class="code" href="classhdnum_1_1ModifiedEuler.html#a1842b79faa9c19fb406c0dfe92ae613d">00134</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1ModifiedEuler.html#a1842b79faa9c19fb406c0dfe92ae613d" title="do one step">step</a> ()
<a name="l00135"></a>00135     {
<a name="l00136"></a>00136       <span class="comment">// stage 1</span>
<a name="l00137"></a>00137       model.f(t,u,k1);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139       <span class="comment">// stage 2</span>
<a name="l00140"></a>00140       w = u;
<a name="l00141"></a>00141       w.update(dt*a21,k1);
<a name="l00142"></a>00142       model.f(t+c2*dt,w,k2);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144       <span class="comment">// final</span>
<a name="l00145"></a>00145       u.update(dt*b2,k2);
<a name="l00146"></a>00146       t += dt;
<a name="l00147"></a>00147     }
<a name="l00148"></a>00148 
<a name="l00150"></a><a class="code" href="classhdnum_1_1ModifiedEuler.html#a5fed8e518bd7f3f12e58c1cc6e6121fb">00150</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1ModifiedEuler.html#a5fed8e518bd7f3f12e58c1cc6e6121fb" title="set current state">set_state</a> (<a class="code" href="classhdnum_1_1ModifiedEuler.html#a1c273cddcddf36f6e47f713080c06b41" title="export time_type">time_type</a> t_, <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; u_)
<a name="l00151"></a>00151     {
<a name="l00152"></a>00152       t = t_;
<a name="l00153"></a>00153       u = u_;
<a name="l00154"></a>00154     }
<a name="l00155"></a>00155 
<a name="l00157"></a><a class="code" href="classhdnum_1_1ModifiedEuler.html#ab73d18011b660a3e7b7c53caecac96b7">00157</a>     <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; <a class="code" href="classhdnum_1_1ModifiedEuler.html#ab73d18011b660a3e7b7c53caecac96b7" title="get current state">get_state</a> ()<span class="keyword"> const</span>
<a name="l00158"></a>00158 <span class="keyword">    </span>{
<a name="l00159"></a>00159       <span class="keywordflow">return</span> u;
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161 
<a name="l00163"></a><a class="code" href="classhdnum_1_1ModifiedEuler.html#a837697657a3543e87c4b3e15ceda8491">00163</a>     <a class="code" href="classhdnum_1_1ModifiedEuler.html#a1c273cddcddf36f6e47f713080c06b41" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1ModifiedEuler.html#a837697657a3543e87c4b3e15ceda8491" title="get current time">get_time</a> ()<span class="keyword"> const</span>
<a name="l00164"></a>00164 <span class="keyword">    </span>{
<a name="l00165"></a>00165       <span class="keywordflow">return</span> t;
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167 
<a name="l00169"></a><a class="code" href="classhdnum_1_1ModifiedEuler.html#a697a2e3423e5ba2a9bd41b61e1358da5">00169</a>     <a class="code" href="classhdnum_1_1ModifiedEuler.html#a1c273cddcddf36f6e47f713080c06b41" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1ModifiedEuler.html#a697a2e3423e5ba2a9bd41b61e1358da5" title="get dt used in last step (i.e. to compute current state)">get_dt</a> ()<span class="keyword"> const</span>
<a name="l00170"></a>00170 <span class="keyword">    </span>{
<a name="l00171"></a>00171       <span class="keywordflow">return</span> dt;
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173 
<a name="l00175"></a><a class="code" href="classhdnum_1_1ModifiedEuler.html#abaf92ae2a3a462996b5208d326cc9a6b">00175</a>     <a class="code" href="classhdnum_1_1ModifiedEuler.html#aa8841e11397920c273afab1f9a04c9bd" title="export size_type">size_type</a> <a class="code" href="classhdnum_1_1ModifiedEuler.html#abaf92ae2a3a462996b5208d326cc9a6b" title="return consistency order of the method">get_order</a> ()<span class="keyword"> const</span>
<a name="l00176"></a>00176 <span class="keyword">    </span>{
<a name="l00177"></a>00177       <span class="keywordflow">return</span> 2;
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179     
<a name="l00180"></a>00180   <span class="keyword">private</span>:
<a name="l00181"></a>00181     <span class="keyword">const</span> M&amp; model;
<a name="l00182"></a>00182     <a class="code" href="classhdnum_1_1ModifiedEuler.html#a1c273cddcddf36f6e47f713080c06b41" title="export time_type">time_type</a> t, dt;
<a name="l00183"></a>00183     <a class="code" href="classhdnum_1_1ModifiedEuler.html#a1c273cddcddf36f6e47f713080c06b41" title="export time_type">time_type</a> c2,a21,b2;
<a name="l00184"></a>00184     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> u,w;
<a name="l00185"></a>00185     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> k1,k2;
<a name="l00186"></a>00186   };
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 
<a name="l00197"></a>00197   <span class="keyword">template</span>&lt;<span class="keyword">class</span> M&gt;
<a name="l00198"></a><a class="code" href="classhdnum_1_1Heun2.html">00198</a>   <span class="keyword">class </span><a class="code" href="classhdnum_1_1Heun2.html" title="Heun method (order 2 with 2 stages).">Heun2</a>
<a name="l00199"></a>00199   {
<a name="l00200"></a>00200   <span class="keyword">public</span>:
<a name="l00202"></a><a class="code" href="classhdnum_1_1Heun2.html#a32d59e62cf1c8dcc50cd2583fae3bf09">00202</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::size_type <a class="code" href="classhdnum_1_1Heun2.html#a32d59e62cf1c8dcc50cd2583fae3bf09" title="export size_type">size_type</a>;
<a name="l00203"></a>00203 
<a name="l00205"></a><a class="code" href="classhdnum_1_1Heun2.html#ac2e59a8551ffbce1455c0fd5266965fd">00205</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::time_type <a class="code" href="classhdnum_1_1Heun2.html#ac2e59a8551ffbce1455c0fd5266965fd" title="export time_type">time_type</a>;
<a name="l00206"></a>00206 
<a name="l00208"></a><a class="code" href="classhdnum_1_1Heun2.html#af16dadf05575fe6ec2c0602fedfe8d2b">00208</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::number_type <a class="code" href="classhdnum_1_1Heun2.html#af16dadf05575fe6ec2c0602fedfe8d2b" title="export number_type">number_type</a>;
<a name="l00209"></a>00209 
<a name="l00211"></a><a class="code" href="classhdnum_1_1Heun2.html#aeddfa6a0a287892a6008da5c95d13dd7">00211</a>     <a class="code" href="classhdnum_1_1Heun2.html#aeddfa6a0a287892a6008da5c95d13dd7" title="constructor stores reference to the model">Heun2</a> (<span class="keyword">const</span> M&amp; model_)
<a name="l00212"></a>00212       : model(model_), u(model.size()), w(model.size()), k1(model.size()), k2(model.size())
<a name="l00213"></a>00213     {
<a name="l00214"></a>00214       c2 = 1.0;
<a name="l00215"></a>00215       a21 = 1.0;
<a name="l00216"></a>00216       b1 = 0.5;
<a name="l00217"></a>00217       b2 = 0.5;
<a name="l00218"></a>00218       model.initialize(t,u);
<a name="l00219"></a>00219       dt = 0.1; 
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221 
<a name="l00223"></a><a class="code" href="classhdnum_1_1Heun2.html#a4998cbb9dc1e4aa127a2209a5d5cb69c">00223</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1Heun2.html#a4998cbb9dc1e4aa127a2209a5d5cb69c" title="set time step for subsequent steps">set_dt</a> (<a class="code" href="classhdnum_1_1Heun2.html#ac2e59a8551ffbce1455c0fd5266965fd" title="export time_type">time_type</a> dt_)
<a name="l00224"></a>00224     {
<a name="l00225"></a>00225       dt = dt_;
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227 
<a name="l00229"></a><a class="code" href="classhdnum_1_1Heun2.html#a967c7c1e842f5400d568ebf0b7c92877">00229</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1Heun2.html#a967c7c1e842f5400d568ebf0b7c92877" title="do one step">step</a> ()
<a name="l00230"></a>00230     {
<a name="l00231"></a>00231       <span class="comment">// stage 1</span>
<a name="l00232"></a>00232       model.f(t,u,k1);
<a name="l00233"></a>00233 
<a name="l00234"></a>00234       <span class="comment">// stage 2</span>
<a name="l00235"></a>00235       w = u;
<a name="l00236"></a>00236       w.update(dt*a21,k1);
<a name="l00237"></a>00237       model.f(t+c2*dt,w,k2);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239       <span class="comment">// final</span>
<a name="l00240"></a>00240       u.update(dt*b1,k1);
<a name="l00241"></a>00241       u.update(dt*b2,k2);
<a name="l00242"></a>00242       t += dt;
<a name="l00243"></a>00243     }
<a name="l00244"></a>00244 
<a name="l00246"></a><a class="code" href="classhdnum_1_1Heun2.html#ad5f075aa349590dbfb2e99fc565dadfc">00246</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1Heun2.html#ad5f075aa349590dbfb2e99fc565dadfc" title="set current state">set_state</a> (<a class="code" href="classhdnum_1_1Heun2.html#ac2e59a8551ffbce1455c0fd5266965fd" title="export time_type">time_type</a> t_, <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; u_)
<a name="l00247"></a>00247     {
<a name="l00248"></a>00248       t = t_;
<a name="l00249"></a>00249       u = u_;
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251 
<a name="l00253"></a><a class="code" href="classhdnum_1_1Heun2.html#ad14ab9cd78584ada47e543820bb73b78">00253</a>     <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; <a class="code" href="classhdnum_1_1Heun2.html#ad14ab9cd78584ada47e543820bb73b78" title="get current state">get_state</a> ()<span class="keyword"> const</span>
<a name="l00254"></a>00254 <span class="keyword">    </span>{
<a name="l00255"></a>00255       <span class="keywordflow">return</span> u;
<a name="l00256"></a>00256     }
<a name="l00257"></a>00257 
<a name="l00259"></a><a class="code" href="classhdnum_1_1Heun2.html#a5ad86e97fa21759e935b1e79b7ff4029">00259</a>     <a class="code" href="classhdnum_1_1Heun2.html#ac2e59a8551ffbce1455c0fd5266965fd" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1Heun2.html#a5ad86e97fa21759e935b1e79b7ff4029" title="get current time">get_time</a> ()<span class="keyword"> const</span>
<a name="l00260"></a>00260 <span class="keyword">    </span>{
<a name="l00261"></a>00261       <span class="keywordflow">return</span> t;
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263 
<a name="l00265"></a><a class="code" href="classhdnum_1_1Heun2.html#abde1a7c6195ecfd92184ed9d08173806">00265</a>     <a class="code" href="classhdnum_1_1Heun2.html#ac2e59a8551ffbce1455c0fd5266965fd" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1Heun2.html#abde1a7c6195ecfd92184ed9d08173806" title="get dt used in last step (i.e. to compute current state)">get_dt</a> ()<span class="keyword"> const</span>
<a name="l00266"></a>00266 <span class="keyword">    </span>{
<a name="l00267"></a>00267       <span class="keywordflow">return</span> dt;
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269 
<a name="l00271"></a><a class="code" href="classhdnum_1_1Heun2.html#a943af41b853f8b3d37e1889a6e60a17b">00271</a>     <a class="code" href="classhdnum_1_1Heun2.html#a32d59e62cf1c8dcc50cd2583fae3bf09" title="export size_type">size_type</a> <a class="code" href="classhdnum_1_1Heun2.html#a943af41b853f8b3d37e1889a6e60a17b" title="return consistency order of the method">get_order</a> ()<span class="keyword"> const</span>
<a name="l00272"></a>00272 <span class="keyword">    </span>{
<a name="l00273"></a>00273       <span class="keywordflow">return</span> 2;
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275     
<a name="l00276"></a>00276   <span class="keyword">private</span>:
<a name="l00277"></a>00277     <span class="keyword">const</span> M&amp; model;
<a name="l00278"></a>00278     <a class="code" href="classhdnum_1_1Heun2.html#ac2e59a8551ffbce1455c0fd5266965fd" title="export time_type">time_type</a> t, dt;
<a name="l00279"></a>00279     <a class="code" href="classhdnum_1_1Heun2.html#ac2e59a8551ffbce1455c0fd5266965fd" title="export time_type">time_type</a> c2,a21,b1,b2;
<a name="l00280"></a>00280     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> u,w;
<a name="l00281"></a>00281     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> k1,k2;
<a name="l00282"></a>00282   };
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 
<a name="l00293"></a>00293   <span class="keyword">template</span>&lt;<span class="keyword">class</span> M&gt;
<a name="l00294"></a><a class="code" href="classhdnum_1_1Heun3.html">00294</a>   <span class="keyword">class </span><a class="code" href="classhdnum_1_1Heun3.html" title="Heun method (order 3 with 3 stages).">Heun3</a>
<a name="l00295"></a>00295   {
<a name="l00296"></a>00296   <span class="keyword">public</span>:
<a name="l00298"></a><a class="code" href="classhdnum_1_1Heun3.html#a99b9c3470be12f9c3e5e3804e77ec316">00298</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::size_type <a class="code" href="classhdnum_1_1Heun3.html#a99b9c3470be12f9c3e5e3804e77ec316" title="export size_type">size_type</a>;
<a name="l00299"></a>00299 
<a name="l00301"></a><a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962">00301</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::time_type <a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a>;
<a name="l00302"></a>00302 
<a name="l00304"></a><a class="code" href="classhdnum_1_1Heun3.html#a4cda69fda9bfa3fb9d2a0ddeca50a29c">00304</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::number_type <a class="code" href="classhdnum_1_1Heun3.html#a4cda69fda9bfa3fb9d2a0ddeca50a29c" title="export number_type">number_type</a>;
<a name="l00305"></a>00305 
<a name="l00307"></a><a class="code" href="classhdnum_1_1Heun3.html#a9994c2f6785c02199cbd2a35e9634a84">00307</a>     <a class="code" href="classhdnum_1_1Heun3.html#a9994c2f6785c02199cbd2a35e9634a84" title="constructor stores reference to the model">Heun3</a> (<span class="keyword">const</span> M&amp; model_)
<a name="l00308"></a>00308       : model(model_), u(model.size()), w(model.size()), k1(model.size()), 
<a name="l00309"></a>00309         k2(model.size()), k3(model.size())
<a name="l00310"></a>00310     {
<a name="l00311"></a>00311       c2 = <a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a>(1.0)/<a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a>(3.0);
<a name="l00312"></a>00312       c3 = <a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a>(2.0)/<a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a>(3.0);
<a name="l00313"></a>00313       a21 = <a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a>(1.0)/<a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a>(3.0);
<a name="l00314"></a>00314       a32 = <a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a>(2.0)/<a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a>(3.0);
<a name="l00315"></a>00315       b1 = 0.25;
<a name="l00316"></a>00316       b2 = 0.0;
<a name="l00317"></a>00317       b3 = 0.75;
<a name="l00318"></a>00318       model.initialize(t,u);
<a name="l00319"></a>00319       dt = 0.1; 
<a name="l00320"></a>00320     }
<a name="l00321"></a>00321 
<a name="l00323"></a><a class="code" href="classhdnum_1_1Heun3.html#a438edc59b90c9a09b80f3d09c865bbda">00323</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1Heun3.html#a438edc59b90c9a09b80f3d09c865bbda" title="set time step for subsequent steps">set_dt</a> (<a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a> dt_)
<a name="l00324"></a>00324     {
<a name="l00325"></a>00325       dt = dt_;
<a name="l00326"></a>00326     }
<a name="l00327"></a>00327 
<a name="l00329"></a><a class="code" href="classhdnum_1_1Heun3.html#ae216ddb0bf8459656dfb62c0a2fd1e69">00329</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1Heun3.html#ae216ddb0bf8459656dfb62c0a2fd1e69" title="do one step">step</a> ()
<a name="l00330"></a>00330     {
<a name="l00331"></a>00331       <span class="comment">// stage 1</span>
<a name="l00332"></a>00332       model.f(t,u,k1);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334       <span class="comment">// stage 2</span>
<a name="l00335"></a>00335       w = u;
<a name="l00336"></a>00336       w.update(dt*a21,k1);
<a name="l00337"></a>00337       model.f(t+c2*dt,w,k2);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339       <span class="comment">// stage 3</span>
<a name="l00340"></a>00340       w = u;
<a name="l00341"></a>00341       w.update(dt*a32,k2);
<a name="l00342"></a>00342       model.f(t+c3*dt,w,k3);
<a name="l00343"></a>00343 
<a name="l00344"></a>00344       <span class="comment">// final</span>
<a name="l00345"></a>00345       u.update(dt*b1,k1);
<a name="l00346"></a>00346       u.update(dt*b3,k3);
<a name="l00347"></a>00347       t += dt;
<a name="l00348"></a>00348     }
<a name="l00349"></a>00349 
<a name="l00351"></a><a class="code" href="classhdnum_1_1Heun3.html#a81644f725426f0aa5bb8ed5dc6d03cec">00351</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1Heun3.html#a81644f725426f0aa5bb8ed5dc6d03cec" title="set current state">set_state</a> (<a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a> t_, <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; u_)
<a name="l00352"></a>00352     {
<a name="l00353"></a>00353       t = t_;
<a name="l00354"></a>00354       u = u_;
<a name="l00355"></a>00355     }
<a name="l00356"></a>00356 
<a name="l00358"></a><a class="code" href="classhdnum_1_1Heun3.html#a776797bef464c76c1f7caa1f43bc9ccf">00358</a>     <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; <a class="code" href="classhdnum_1_1Heun3.html#a776797bef464c76c1f7caa1f43bc9ccf" title="get current state">get_state</a> ()<span class="keyword"> const</span>
<a name="l00359"></a>00359 <span class="keyword">    </span>{
<a name="l00360"></a>00360       <span class="keywordflow">return</span> u;
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362 
<a name="l00364"></a><a class="code" href="classhdnum_1_1Heun3.html#ad5438e8365dba3b2cc885a4d22fe0789">00364</a>     <a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1Heun3.html#ad5438e8365dba3b2cc885a4d22fe0789" title="get current time">get_time</a> ()<span class="keyword"> const</span>
<a name="l00365"></a>00365 <span class="keyword">    </span>{
<a name="l00366"></a>00366       <span class="keywordflow">return</span> t;
<a name="l00367"></a>00367     }
<a name="l00368"></a>00368 
<a name="l00370"></a><a class="code" href="classhdnum_1_1Heun3.html#a55e46de6d92d67c40ee2aa84cbc4a8d7">00370</a>     <a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1Heun3.html#a55e46de6d92d67c40ee2aa84cbc4a8d7" title="get dt used in last step (i.e. to compute current state)">get_dt</a> ()<span class="keyword"> const</span>
<a name="l00371"></a>00371 <span class="keyword">    </span>{
<a name="l00372"></a>00372       <span class="keywordflow">return</span> dt;
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374 
<a name="l00376"></a><a class="code" href="classhdnum_1_1Heun3.html#ab6db7ad9e5a6db68e23782dd83200d86">00376</a>     <a class="code" href="classhdnum_1_1Heun3.html#a99b9c3470be12f9c3e5e3804e77ec316" title="export size_type">size_type</a> <a class="code" href="classhdnum_1_1Heun3.html#ab6db7ad9e5a6db68e23782dd83200d86" title="return consistency order of the method">get_order</a> ()<span class="keyword"> const</span>
<a name="l00377"></a>00377 <span class="keyword">    </span>{
<a name="l00378"></a>00378       <span class="keywordflow">return</span> 3;
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380     
<a name="l00381"></a>00381   <span class="keyword">private</span>:
<a name="l00382"></a>00382     <span class="keyword">const</span> M&amp; model;
<a name="l00383"></a>00383     <a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a> t, dt;
<a name="l00384"></a>00384     <a class="code" href="classhdnum_1_1Heun3.html#a48fcfee8624c3e7984dc054d641ff962" title="export time_type">time_type</a> c2,c3,a21,a31,a32,b1,b2,b3;
<a name="l00385"></a>00385     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> u,w;
<a name="l00386"></a>00386     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> k1,k2,k3;
<a name="l00387"></a>00387   };
<a name="l00388"></a>00388 
<a name="l00397"></a>00397   <span class="keyword">template</span>&lt;<span class="keyword">class</span> M&gt;
<a name="l00398"></a><a class="code" href="classhdnum_1_1Kutta3.html">00398</a>   <span class="keyword">class </span><a class="code" href="classhdnum_1_1Kutta3.html" title="Kutta method (order 3 with 3 stages).">Kutta3</a>
<a name="l00399"></a>00399   {
<a name="l00400"></a>00400   <span class="keyword">public</span>:
<a name="l00402"></a><a class="code" href="classhdnum_1_1Kutta3.html#aa219675a459b3d48c8ac301a1f6d712b">00402</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::size_type <a class="code" href="classhdnum_1_1Kutta3.html#aa219675a459b3d48c8ac301a1f6d712b" title="export size_type">size_type</a>;
<a name="l00403"></a>00403 
<a name="l00405"></a><a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e">00405</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::time_type <a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a>;
<a name="l00406"></a>00406 
<a name="l00408"></a><a class="code" href="classhdnum_1_1Kutta3.html#a06dc1fee934f3a4cbb530f4bc4704b99">00408</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::number_type <a class="code" href="classhdnum_1_1Kutta3.html#a06dc1fee934f3a4cbb530f4bc4704b99" title="export number_type">number_type</a>;
<a name="l00409"></a>00409 
<a name="l00411"></a><a class="code" href="classhdnum_1_1Kutta3.html#af743deba93833d61ae035a5c3eb5b563">00411</a>     <a class="code" href="classhdnum_1_1Kutta3.html#af743deba93833d61ae035a5c3eb5b563" title="constructor stores reference to the model">Kutta3</a> (<span class="keyword">const</span> M&amp; model_)
<a name="l00412"></a>00412       : model(model_), u(model.size()), w(model.size()), k1(model.size()), 
<a name="l00413"></a>00413         k2(model.size()), k3(model.size())
<a name="l00414"></a>00414     {
<a name="l00415"></a>00415       c2 = 0.5;
<a name="l00416"></a>00416       c3 = 1.0;
<a name="l00417"></a>00417       a21 = 0.5;
<a name="l00418"></a>00418       a31 = -1.0;
<a name="l00419"></a>00419       a32 = 2.0;
<a name="l00420"></a>00420       b1 = <a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a>(1.0)/<a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a>(6.0);
<a name="l00421"></a>00421       b2 = <a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a>(4.0)/<a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a>(6.0);
<a name="l00422"></a>00422       b3 = <a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a>(1.0)/<a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a>(6.0);
<a name="l00423"></a>00423       model.initialize(t,u);
<a name="l00424"></a>00424       dt = 0.1; 
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426 
<a name="l00428"></a><a class="code" href="classhdnum_1_1Kutta3.html#ac5b0e2c4ae00e3d3faf7d83351f76866">00428</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1Kutta3.html#ac5b0e2c4ae00e3d3faf7d83351f76866" title="set time step for subsequent steps">set_dt</a> (<a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a> dt_)
<a name="l00429"></a>00429     {
<a name="l00430"></a>00430       dt = dt_;
<a name="l00431"></a>00431     }
<a name="l00432"></a>00432 
<a name="l00434"></a><a class="code" href="classhdnum_1_1Kutta3.html#a5c97bd9408b64f29052781b8a62180b4">00434</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1Kutta3.html#a5c97bd9408b64f29052781b8a62180b4" title="do one step">step</a> ()
<a name="l00435"></a>00435     {
<a name="l00436"></a>00436       <span class="comment">// stage 1</span>
<a name="l00437"></a>00437       model.f(t,u,k1);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439       <span class="comment">// stage 2</span>
<a name="l00440"></a>00440       w = u;
<a name="l00441"></a>00441       w.update(dt*a21,k1);
<a name="l00442"></a>00442       model.f(t+c2*dt,w,k2);
<a name="l00443"></a>00443 
<a name="l00444"></a>00444       <span class="comment">// stage 3</span>
<a name="l00445"></a>00445       w = u;
<a name="l00446"></a>00446       w.update(dt*a31,k1);
<a name="l00447"></a>00447       w.update(dt*a32,k2);
<a name="l00448"></a>00448       model.f(t+c3*dt,w,k3);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450       <span class="comment">// final</span>
<a name="l00451"></a>00451       u.update(dt*b1,k1);
<a name="l00452"></a>00452       u.update(dt*b2,k2);
<a name="l00453"></a>00453       u.update(dt*b3,k3);
<a name="l00454"></a>00454       t += dt;
<a name="l00455"></a>00455     }
<a name="l00456"></a>00456 
<a name="l00458"></a><a class="code" href="classhdnum_1_1Kutta3.html#a474ab02413887a0c1fadb81a7e4fb851">00458</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1Kutta3.html#a474ab02413887a0c1fadb81a7e4fb851" title="set current state">set_state</a> (<a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a> t_, <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; u_)
<a name="l00459"></a>00459     {
<a name="l00460"></a>00460       t = t_;
<a name="l00461"></a>00461       u = u_;
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463 
<a name="l00465"></a><a class="code" href="classhdnum_1_1Kutta3.html#add2141212e9549fd50e15deedf892b3e">00465</a>     <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; <a class="code" href="classhdnum_1_1Kutta3.html#add2141212e9549fd50e15deedf892b3e" title="get current state">get_state</a> ()<span class="keyword"> const</span>
<a name="l00466"></a>00466 <span class="keyword">    </span>{
<a name="l00467"></a>00467       <span class="keywordflow">return</span> u;
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469 
<a name="l00471"></a><a class="code" href="classhdnum_1_1Kutta3.html#a11598389a3a0bd0403b2906c147640e2">00471</a>     <a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1Kutta3.html#a11598389a3a0bd0403b2906c147640e2" title="get current time">get_time</a> ()<span class="keyword"> const</span>
<a name="l00472"></a>00472 <span class="keyword">    </span>{
<a name="l00473"></a>00473       <span class="keywordflow">return</span> t;
<a name="l00474"></a>00474     }
<a name="l00475"></a>00475 
<a name="l00477"></a><a class="code" href="classhdnum_1_1Kutta3.html#a365f2f78d21f7db184a88665ac1f9b58">00477</a>     <a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1Kutta3.html#a365f2f78d21f7db184a88665ac1f9b58" title="get dt used in last step (i.e. to compute current state)">get_dt</a> ()<span class="keyword"> const</span>
<a name="l00478"></a>00478 <span class="keyword">    </span>{
<a name="l00479"></a>00479       <span class="keywordflow">return</span> dt;
<a name="l00480"></a>00480     }
<a name="l00481"></a>00481 
<a name="l00483"></a><a class="code" href="classhdnum_1_1Kutta3.html#a47f10303531b80d34d84cbae496b0543">00483</a>     <a class="code" href="classhdnum_1_1Kutta3.html#aa219675a459b3d48c8ac301a1f6d712b" title="export size_type">size_type</a> <a class="code" href="classhdnum_1_1Kutta3.html#a47f10303531b80d34d84cbae496b0543" title="return consistency order of the method">get_order</a> ()<span class="keyword"> const</span>
<a name="l00484"></a>00484 <span class="keyword">    </span>{
<a name="l00485"></a>00485       <span class="keywordflow">return</span> 3;
<a name="l00486"></a>00486     }
<a name="l00487"></a>00487     
<a name="l00488"></a>00488   <span class="keyword">private</span>:
<a name="l00489"></a>00489     <span class="keyword">const</span> M&amp; model;
<a name="l00490"></a>00490     <a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a> t, dt;
<a name="l00491"></a>00491     <a class="code" href="classhdnum_1_1Kutta3.html#a0055d10b545c5cf60a16fd3a88a6042e" title="export time_type">time_type</a> c2,c3,a21,a31,a32,b1,b2,b3;
<a name="l00492"></a>00492     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> u,w;
<a name="l00493"></a>00493     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> k1,k2,k3;
<a name="l00494"></a>00494   };
<a name="l00495"></a>00495 
<a name="l00504"></a>00504   <span class="keyword">template</span>&lt;<span class="keyword">class</span> M&gt;
<a name="l00505"></a><a class="code" href="classhdnum_1_1RungeKutta4.html">00505</a>   <span class="keyword">class </span><a class="code" href="classhdnum_1_1RungeKutta4.html" title="classical Runge-Kutta method (order 4 with 4 stages)">RungeKutta4</a>
<a name="l00506"></a>00506   {
<a name="l00507"></a>00507   <span class="keyword">public</span>:
<a name="l00509"></a><a class="code" href="classhdnum_1_1RungeKutta4.html#a35c0f2a31327913676b7287fb1ef23dc">00509</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::size_type <a class="code" href="classhdnum_1_1RungeKutta4.html#a35c0f2a31327913676b7287fb1ef23dc" title="export size_type">size_type</a>;
<a name="l00510"></a>00510 
<a name="l00512"></a><a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84">00512</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::time_type <a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a>;
<a name="l00513"></a>00513 
<a name="l00515"></a><a class="code" href="classhdnum_1_1RungeKutta4.html#a8a2af290f6503769876570bba58fdff2">00515</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::number_type <a class="code" href="classhdnum_1_1RungeKutta4.html#a8a2af290f6503769876570bba58fdff2" title="export number_type">number_type</a>;
<a name="l00516"></a>00516 
<a name="l00518"></a><a class="code" href="classhdnum_1_1RungeKutta4.html#a576f1d99c638594c745b54956254c100">00518</a>     <a class="code" href="classhdnum_1_1RungeKutta4.html#a576f1d99c638594c745b54956254c100" title="constructor stores reference to the model">RungeKutta4</a> (<span class="keyword">const</span> M&amp; model_)
<a name="l00519"></a>00519       : model(model_), u(model.size()), w(model.size()), k1(model.size()), 
<a name="l00520"></a>00520         k2(model.size()), k3(model.size()), k4(model.size())
<a name="l00521"></a>00521     {
<a name="l00522"></a>00522       c2 = 0.5;
<a name="l00523"></a>00523       c3 = 0.5;
<a name="l00524"></a>00524       c4 = 1.0;
<a name="l00525"></a>00525       a21 = 0.5;
<a name="l00526"></a>00526       a32 = 0.5;
<a name="l00527"></a>00527       a43 = 1.0;
<a name="l00528"></a>00528       b1 = <a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a>(1.0)/<a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a>(6.0);
<a name="l00529"></a>00529       b2 = <a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a>(2.0)/<a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a>(6.0);
<a name="l00530"></a>00530       b3 = <a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a>(2.0)/<a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a>(6.0);
<a name="l00531"></a>00531       b4 = <a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a>(1.0)/<a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a>(6.0);
<a name="l00532"></a>00532       model.initialize(t,u);
<a name="l00533"></a>00533       dt = 0.1; 
<a name="l00534"></a>00534     }
<a name="l00535"></a>00535 
<a name="l00537"></a><a class="code" href="classhdnum_1_1RungeKutta4.html#a035f34c6ac918a9ae8f0fd2bc67da620">00537</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1RungeKutta4.html#a035f34c6ac918a9ae8f0fd2bc67da620" title="set time step for subsequent steps">set_dt</a> (<a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a> dt_)
<a name="l00538"></a>00538     {
<a name="l00539"></a>00539       dt = dt_;
<a name="l00540"></a>00540     }
<a name="l00541"></a>00541 
<a name="l00543"></a><a class="code" href="classhdnum_1_1RungeKutta4.html#a243e063d6c0a8982a4addc1d97f547e0">00543</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1RungeKutta4.html#a243e063d6c0a8982a4addc1d97f547e0" title="do one step">step</a> ()
<a name="l00544"></a>00544     {
<a name="l00545"></a>00545       <span class="comment">// stage 1</span>
<a name="l00546"></a>00546       model.f(t,u,k1);
<a name="l00547"></a>00547 
<a name="l00548"></a>00548       <span class="comment">// stage 2</span>
<a name="l00549"></a>00549       w = u;
<a name="l00550"></a>00550       w.update(dt*a21,k1);
<a name="l00551"></a>00551       model.f(t+c2*dt,w,k2);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553       <span class="comment">// stage 3</span>
<a name="l00554"></a>00554       w = u;
<a name="l00555"></a>00555       w.update(dt*a32,k2);
<a name="l00556"></a>00556       model.f(t+c3*dt,w,k3);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558       <span class="comment">// stage 4</span>
<a name="l00559"></a>00559       w = u;
<a name="l00560"></a>00560       w.update(dt*a43,k3);
<a name="l00561"></a>00561       model.f(t+c4*dt,w,k4);
<a name="l00562"></a>00562 
<a name="l00563"></a>00563       <span class="comment">// final</span>
<a name="l00564"></a>00564       u.update(dt*b1,k1);
<a name="l00565"></a>00565       u.update(dt*b2,k2);
<a name="l00566"></a>00566       u.update(dt*b3,k3);
<a name="l00567"></a>00567       u.update(dt*b4,k4);
<a name="l00568"></a>00568       t += dt;
<a name="l00569"></a>00569     }
<a name="l00570"></a>00570 
<a name="l00572"></a><a class="code" href="classhdnum_1_1RungeKutta4.html#a06f337a2c23a40ea1cb798365879c9aa">00572</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1RungeKutta4.html#a06f337a2c23a40ea1cb798365879c9aa" title="set current state">set_state</a> (<a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a> t_, <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; u_)
<a name="l00573"></a>00573     {
<a name="l00574"></a>00574       t = t_;
<a name="l00575"></a>00575       u = u_;
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577 
<a name="l00579"></a><a class="code" href="classhdnum_1_1RungeKutta4.html#a2769ffd570ccb23004b4996a4cebf279">00579</a>     <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; <a class="code" href="classhdnum_1_1RungeKutta4.html#a2769ffd570ccb23004b4996a4cebf279" title="get current state">get_state</a> ()<span class="keyword"> const</span>
<a name="l00580"></a>00580 <span class="keyword">    </span>{
<a name="l00581"></a>00581       <span class="keywordflow">return</span> u;
<a name="l00582"></a>00582     }
<a name="l00583"></a>00583 
<a name="l00585"></a><a class="code" href="classhdnum_1_1RungeKutta4.html#a371015562c4918d748b49df3c521b0d0">00585</a>     <a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1RungeKutta4.html#a371015562c4918d748b49df3c521b0d0" title="get current time">get_time</a> ()<span class="keyword"> const</span>
<a name="l00586"></a>00586 <span class="keyword">    </span>{
<a name="l00587"></a>00587       <span class="keywordflow">return</span> t;
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589 
<a name="l00591"></a><a class="code" href="classhdnum_1_1RungeKutta4.html#aa808a6a3dfd672359999e44906da4692">00591</a>     <a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1RungeKutta4.html#aa808a6a3dfd672359999e44906da4692" title="get dt used in last step (i.e. to compute current state)">get_dt</a> ()<span class="keyword"> const</span>
<a name="l00592"></a>00592 <span class="keyword">    </span>{
<a name="l00593"></a>00593       <span class="keywordflow">return</span> dt;
<a name="l00594"></a>00594     }
<a name="l00595"></a>00595 
<a name="l00597"></a><a class="code" href="classhdnum_1_1RungeKutta4.html#a74544dbe43813719b549d97903772a52">00597</a>     <a class="code" href="classhdnum_1_1RungeKutta4.html#a35c0f2a31327913676b7287fb1ef23dc" title="export size_type">size_type</a> <a class="code" href="classhdnum_1_1RungeKutta4.html#a74544dbe43813719b549d97903772a52" title="return consistency order of the method">get_order</a> ()<span class="keyword"> const</span>
<a name="l00598"></a>00598 <span class="keyword">    </span>{
<a name="l00599"></a>00599       <span class="keywordflow">return</span> 4;
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601     
<a name="l00602"></a>00602   <span class="keyword">private</span>:
<a name="l00603"></a>00603     <span class="keyword">const</span> M&amp; model;
<a name="l00604"></a>00604     <a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a> t, dt;
<a name="l00605"></a>00605     <a class="code" href="classhdnum_1_1RungeKutta4.html#accd5f055f7a407e0012622fbf4298e84" title="export time_type">time_type</a> c2,c3,c4,a21,a32,a43,b1,b2,b3,b4;
<a name="l00606"></a>00606     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> u,w;
<a name="l00607"></a>00607     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> k1,k2,k3,k4;
<a name="l00608"></a>00608   };
<a name="l00609"></a>00609 
<a name="l00614"></a>00614   <span class="keyword">template</span>&lt;<span class="keyword">class</span> M&gt;
<a name="l00615"></a><a class="code" href="classhdnum_1_1RKF45.html">00615</a>   <span class="keyword">class </span><a class="code" href="classhdnum_1_1RKF45.html" title="Adaptive Runge-Kutta-Fehlberg method.">RKF45</a>
<a name="l00616"></a>00616   {
<a name="l00617"></a>00617   <span class="keyword">public</span>:
<a name="l00619"></a><a class="code" href="classhdnum_1_1RKF45.html#a7fd97c231601ffb9373fbb5dad8a60f3">00619</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::size_type <a class="code" href="classhdnum_1_1RKF45.html#a7fd97c231601ffb9373fbb5dad8a60f3" title="export size_type">size_type</a>;
<a name="l00620"></a>00620 
<a name="l00622"></a><a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00">00622</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::time_type <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>;
<a name="l00623"></a>00623 
<a name="l00625"></a><a class="code" href="classhdnum_1_1RKF45.html#af34f11a4cdc46bb0323db78fcb3712da">00625</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::number_type <a class="code" href="classhdnum_1_1RKF45.html#af34f11a4cdc46bb0323db78fcb3712da" title="export number_type">number_type</a>;
<a name="l00626"></a>00626 
<a name="l00628"></a><a class="code" href="classhdnum_1_1RKF45.html#a7757b93351fc2a2a98fe503ef92dbe3b">00628</a>     <a class="code" href="classhdnum_1_1RKF45.html#a7757b93351fc2a2a98fe503ef92dbe3b" title="constructor stores reference to the model">RKF45</a> (<span class="keyword">const</span> M&amp; model_)
<a name="l00629"></a>00629       : model(model_), u(model.size()), w(model.size()), ww(model.size()), k1(model.size()), 
<a name="l00630"></a>00630         k2(model.size()), k3(model.size()), k4(model.size()), k5(model.size()), k6(model.size()),
<a name="l00631"></a>00631         steps(0), rejected(0)
<a name="l00632"></a>00632     {
<a name="l00633"></a>00633       TOL = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(0.0001);
<a name="l00634"></a>00634       rho = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(0.8);
<a name="l00635"></a>00635       alpha = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(0.25);
<a name="l00636"></a>00636       beta = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(4.0);
<a name="l00637"></a>00637       dt_min = 1E-12;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639       c2 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(1.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(4.0);
<a name="l00640"></a>00640       c3 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(3.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(8.0);
<a name="l00641"></a>00641       c4 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(12.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(13.0);
<a name="l00642"></a>00642       c5 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(1.0);
<a name="l00643"></a>00643       c6 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(1.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(2.0);
<a name="l00644"></a>00644 
<a name="l00645"></a>00645       a21 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(1.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(4.0);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647       a31 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(3.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(32.0);
<a name="l00648"></a>00648       a32 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(9.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(32.0);
<a name="l00649"></a>00649 
<a name="l00650"></a>00650       a41 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(1932.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(2197.0);
<a name="l00651"></a>00651       a42 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(-7200.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(2197.0);
<a name="l00652"></a>00652       a43 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(7296.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(2197.0);
<a name="l00653"></a>00653 
<a name="l00654"></a>00654       a51 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(439.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(216.0);
<a name="l00655"></a>00655       a52 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(-8.0);
<a name="l00656"></a>00656       a53 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(3680.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(513.0);
<a name="l00657"></a>00657       a54 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(-845.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(4104.0);
<a name="l00658"></a>00658 
<a name="l00659"></a>00659       a61 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(-8.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(27.0);
<a name="l00660"></a>00660       a62 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(2.0);
<a name="l00661"></a>00661       a63 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(-3544.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(2565.0);
<a name="l00662"></a>00662       a64 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(1859.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(4104.0);
<a name="l00663"></a>00663       a65 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(-11.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(40.0);
<a name="l00664"></a>00664 
<a name="l00665"></a>00665       b1 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(25.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(216.0);
<a name="l00666"></a>00666       b2 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(0.0);
<a name="l00667"></a>00667       b3 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(1408.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(2565.0);
<a name="l00668"></a>00668       b4 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(2197.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(4104.0);
<a name="l00669"></a>00669       b5 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(-1.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(5.0);
<a name="l00670"></a>00670 
<a name="l00671"></a>00671       bb1 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(16.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(135.0);
<a name="l00672"></a>00672       bb2 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(0.0);
<a name="l00673"></a>00673       bb3 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(6656.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(12825.0);
<a name="l00674"></a>00674       bb4 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(28561.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(56430.0);
<a name="l00675"></a>00675       bb5 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(-9.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(50.0);
<a name="l00676"></a>00676       bb6 = <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(2.0)/<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a>(55.0);
<a name="l00677"></a>00677 
<a name="l00678"></a>00678       model.initialize(t,u);
<a name="l00679"></a>00679       dt = 0.1; 
<a name="l00680"></a>00680     }
<a name="l00681"></a>00681 
<a name="l00683"></a><a class="code" href="classhdnum_1_1RKF45.html#aa0724f83cd7bb44451e21b1780b3f100">00683</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1RKF45.html#aa0724f83cd7bb44451e21b1780b3f100" title="set time step for subsequent steps">set_dt</a> (<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a> dt_)
<a name="l00684"></a>00684     {
<a name="l00685"></a>00685       dt = dt_;
<a name="l00686"></a>00686     }
<a name="l00687"></a>00687 
<a name="l00689"></a><a class="code" href="classhdnum_1_1RKF45.html#ac5c815988db76d77a28e1833dd6a6cb6">00689</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1RKF45.html#ac5c815988db76d77a28e1833dd6a6cb6" title="set tolerance for adaptive computation">set_TOL</a> (<a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a> TOL_)
<a name="l00690"></a>00690     {
<a name="l00691"></a>00691       TOL = TOL_;
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693 
<a name="l00695"></a><a class="code" href="classhdnum_1_1RKF45.html#aa61bd540faf3b35e42788e5127a2ecf1">00695</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1RKF45.html#aa61bd540faf3b35e42788e5127a2ecf1" title="do one step">step</a> ()
<a name="l00696"></a>00696     {
<a name="l00697"></a>00697       steps++;
<a name="l00698"></a>00698 
<a name="l00699"></a>00699       <span class="comment">// stage 1</span>
<a name="l00700"></a>00700       model.f(t,u,k1);
<a name="l00701"></a>00701 
<a name="l00702"></a>00702       <span class="comment">// stage 2</span>
<a name="l00703"></a>00703       w = u;
<a name="l00704"></a>00704       w.update(dt*a21,k1);
<a name="l00705"></a>00705       model.f(t+c2*dt,w,k2);
<a name="l00706"></a>00706 
<a name="l00707"></a>00707       <span class="comment">// stage 3</span>
<a name="l00708"></a>00708       w = u;
<a name="l00709"></a>00709       w.update(dt*a31,k1);
<a name="l00710"></a>00710       w.update(dt*a32,k2);
<a name="l00711"></a>00711       model.f(t+c3*dt,w,k3);
<a name="l00712"></a>00712 
<a name="l00713"></a>00713       <span class="comment">// stage 4</span>
<a name="l00714"></a>00714       w = u;
<a name="l00715"></a>00715       w.update(dt*a41,k1);
<a name="l00716"></a>00716       w.update(dt*a42,k2);
<a name="l00717"></a>00717       w.update(dt*a43,k3);
<a name="l00718"></a>00718       model.f(t+c4*dt,w,k4);
<a name="l00719"></a>00719 
<a name="l00720"></a>00720       <span class="comment">// stage 5</span>
<a name="l00721"></a>00721       w = u;
<a name="l00722"></a>00722       w.update(dt*a51,k1);
<a name="l00723"></a>00723       w.update(dt*a52,k2);
<a name="l00724"></a>00724       w.update(dt*a53,k3);
<a name="l00725"></a>00725       w.update(dt*a54,k4);
<a name="l00726"></a>00726       model.f(t+c5*dt,w,k5);
<a name="l00727"></a>00727 
<a name="l00728"></a>00728       <span class="comment">// stage 6</span>
<a name="l00729"></a>00729       w = u;
<a name="l00730"></a>00730       w.update(dt*a61,k1);
<a name="l00731"></a>00731       w.update(dt*a62,k2);
<a name="l00732"></a>00732       w.update(dt*a63,k3);
<a name="l00733"></a>00733       w.update(dt*a64,k4);
<a name="l00734"></a>00734       w.update(dt*a65,k5);
<a name="l00735"></a>00735       model.f(t+c6*dt,w,k6);
<a name="l00736"></a>00736 
<a name="l00737"></a>00737       <span class="comment">// compute order 4 approximation</span>
<a name="l00738"></a>00738       w = u;
<a name="l00739"></a>00739       w.update(dt*b1,k1);
<a name="l00740"></a>00740       w.update(dt*b2,k2);
<a name="l00741"></a>00741       w.update(dt*b3,k3);
<a name="l00742"></a>00742       w.update(dt*b4,k4);
<a name="l00743"></a>00743       w.update(dt*b5,k5);
<a name="l00744"></a>00744 
<a name="l00745"></a>00745       <span class="comment">// compute order 5 approximation</span>
<a name="l00746"></a>00746       ww = u;
<a name="l00747"></a>00747       ww.update(dt*bb1,k1);
<a name="l00748"></a>00748       ww.update(dt*bb2,k2);
<a name="l00749"></a>00749       ww.update(dt*bb3,k3);
<a name="l00750"></a>00750       ww.update(dt*bb4,k4);
<a name="l00751"></a>00751       ww.update(dt*bb5,k5);
<a name="l00752"></a>00752       ww.update(dt*bb6,k6);
<a name="l00753"></a>00753 
<a name="l00754"></a>00754       <span class="comment">// estimate local error</span>
<a name="l00755"></a>00755       w -= ww;
<a name="l00756"></a>00756       <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a> error(norm(w));
<a name="l00757"></a>00757       <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a> dt_opt(dt*pow(rho*TOL/error,0.2));
<a name="l00758"></a>00758       dt_opt = std::min(beta*dt,std::max(alpha*dt,dt_opt));
<a name="l00759"></a>00759       <span class="comment">//std::cout &lt;&lt; &quot;est. error=&quot; &lt;&lt; error &lt;&lt; &quot; dt_opt=&quot; &lt;&lt; dt_opt &lt;&lt; std::endl;</span>
<a name="l00760"></a>00760 
<a name="l00761"></a>00761       <span class="keywordflow">if</span> (error&lt;=TOL)
<a name="l00762"></a>00762         {
<a name="l00763"></a>00763           t += dt;
<a name="l00764"></a>00764           u = ww;
<a name="l00765"></a>00765           dt = dt_opt;
<a name="l00766"></a>00766         }
<a name="l00767"></a>00767       <span class="keywordflow">else</span>
<a name="l00768"></a>00768         {
<a name="l00769"></a>00769           rejected++;
<a name="l00770"></a>00770           dt = dt_opt;
<a name="l00771"></a>00771           <span class="keywordflow">if</span> (dt&gt;dt_min) <a class="code" href="classhdnum_1_1RKF45.html#aa61bd540faf3b35e42788e5127a2ecf1" title="do one step">step</a>();
<a name="l00772"></a>00772         }
<a name="l00773"></a>00773     }
<a name="l00774"></a>00774 
<a name="l00776"></a><a class="code" href="classhdnum_1_1RKF45.html#a13ea82e111ab9e30fd9b6faf5e825e3d">00776</a>     <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; <a class="code" href="classhdnum_1_1RKF45.html#a13ea82e111ab9e30fd9b6faf5e825e3d" title="get current state">get_state</a> ()<span class="keyword"> const</span>
<a name="l00777"></a>00777 <span class="keyword">    </span>{
<a name="l00778"></a>00778       <span class="keywordflow">return</span> u;
<a name="l00779"></a>00779     }
<a name="l00780"></a>00780 
<a name="l00782"></a><a class="code" href="classhdnum_1_1RKF45.html#a5f9dfeeba9abeee37fdc5e8d79d30488">00782</a>     <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1RKF45.html#a5f9dfeeba9abeee37fdc5e8d79d30488" title="get current time">get_time</a> ()<span class="keyword"> const</span>
<a name="l00783"></a>00783 <span class="keyword">    </span>{
<a name="l00784"></a>00784       <span class="keywordflow">return</span> t;
<a name="l00785"></a>00785     }
<a name="l00786"></a>00786 
<a name="l00788"></a><a class="code" href="classhdnum_1_1RKF45.html#aee7cdf5b333ca31418917f76ab70dcef">00788</a>     <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1RKF45.html#aee7cdf5b333ca31418917f76ab70dcef" title="get dt used in last step (i.e. to compute current state)">get_dt</a> ()<span class="keyword"> const</span>
<a name="l00789"></a>00789 <span class="keyword">    </span>{
<a name="l00790"></a>00790       <span class="keywordflow">return</span> dt;
<a name="l00791"></a>00791     }
<a name="l00792"></a>00792 
<a name="l00794"></a><a class="code" href="classhdnum_1_1RKF45.html#ace56b907855d8323b4161ebc3e3d20dc">00794</a>     <a class="code" href="classhdnum_1_1RKF45.html#a7fd97c231601ffb9373fbb5dad8a60f3" title="export size_type">size_type</a> <a class="code" href="classhdnum_1_1RKF45.html#ace56b907855d8323b4161ebc3e3d20dc" title="return consistency order of the method">get_order</a> ()<span class="keyword"> const</span>
<a name="l00795"></a>00795 <span class="keyword">    </span>{
<a name="l00796"></a>00796       <span class="keywordflow">return</span> 5;
<a name="l00797"></a>00797     }
<a name="l00798"></a>00798     
<a name="l00800"></a><a class="code" href="classhdnum_1_1RKF45.html#af3f56f53dc2398a808e4fa85c658c56c">00800</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1RKF45.html#af3f56f53dc2398a808e4fa85c658c56c" title="print some information">get_info</a> ()<span class="keyword"> const</span>
<a name="l00801"></a>00801 <span class="keyword">    </span>{
<a name="l00802"></a>00802       std::cout &lt;&lt; <span class="stringliteral">&quot;RE: steps=&quot;</span> &lt;&lt; steps &lt;&lt; <span class="stringliteral">&quot; rejected=&quot;</span> &lt;&lt; rejected &lt;&lt; std::endl;
<a name="l00803"></a>00803     }
<a name="l00804"></a>00804 
<a name="l00805"></a>00805   <span class="keyword">private</span>:
<a name="l00806"></a>00806     <span class="keyword">const</span> M&amp; model;
<a name="l00807"></a>00807     <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a> t, dt;
<a name="l00808"></a>00808     <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a> TOL,rho,alpha,beta,dt_min;
<a name="l00809"></a>00809     <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a> c2,c3,c4,c5,c6;
<a name="l00810"></a>00810     <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a> a21,a31,a32,a41,a42,a43,a51,a52,a53,a54,a61,a62,a63,a64,a65;
<a name="l00811"></a>00811     <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a> b1,b2,b3,b4,b5; <span class="comment">// 4th order</span>
<a name="l00812"></a>00812     <a class="code" href="classhdnum_1_1RKF45.html#a27ab73a7d7756f59d4422a96afd9ea00" title="export time_type">time_type</a> bb1,bb2,bb3,bb4,bb5,bb6; <span class="comment">// 5th order</span>
<a name="l00813"></a>00813     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> u,w,ww;
<a name="l00814"></a>00814     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> k1,k2,k3,k4,k5,k6;
<a name="l00815"></a>00815     <span class="keyword">mutable</span> <a class="code" href="classhdnum_1_1RKF45.html#a7fd97c231601ffb9373fbb5dad8a60f3" title="export size_type">size_type</a> steps, rejected;
<a name="l00816"></a>00816   };
<a name="l00817"></a>00817 
<a name="l00818"></a>00818 
<a name="l00824"></a>00824   <span class="keyword">template</span>&lt;<span class="keyword">class</span> M, <span class="keyword">class</span> S&gt;
<a name="l00825"></a><a class="code" href="classhdnum_1_1RE.html">00825</a>   <span class="keyword">class </span><a class="code" href="classhdnum_1_1RE.html" title="Adaptive one-step method using Richardson extrapolation.">RE</a>
<a name="l00826"></a>00826   {
<a name="l00827"></a>00827   <span class="keyword">public</span>:
<a name="l00829"></a><a class="code" href="classhdnum_1_1RE.html#ac69dd564f38accecac013e6fdfea00e1">00829</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::size_type <a class="code" href="classhdnum_1_1RE.html#ac69dd564f38accecac013e6fdfea00e1" title="export size_type">size_type</a>;
<a name="l00830"></a>00830 
<a name="l00832"></a><a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7">00832</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::time_type <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a>;
<a name="l00833"></a>00833 
<a name="l00835"></a><a class="code" href="classhdnum_1_1RE.html#a0223c61d464ed8b6fd3e84878e1b6cec">00835</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::number_type <a class="code" href="classhdnum_1_1RE.html#a0223c61d464ed8b6fd3e84878e1b6cec" title="export number_type">number_type</a>;
<a name="l00836"></a>00836 
<a name="l00838"></a><a class="code" href="classhdnum_1_1RE.html#a32795cf679545f00cb1d750cee95d168">00838</a>     <a class="code" href="classhdnum_1_1RE.html#a32795cf679545f00cb1d750cee95d168" title="constructor stores reference to the model">RE</a> (<span class="keyword">const</span> M&amp; model_, S&amp; solver_)
<a name="l00839"></a>00839       : model(model_), solver(solver_), u(model.size()), 
<a name="l00840"></a>00840         wlow(model.size()), whigh(model.size()), ww(model.size()),
<a name="l00841"></a>00841         steps(0), rejected(0)
<a name="l00842"></a>00842     {
<a name="l00843"></a>00843       model.initialize(t,u); <span class="comment">// initialize state</span>
<a name="l00844"></a>00844       dt = 0.1;              <span class="comment">// set initial time step</span>
<a name="l00845"></a>00845       two_power_m = 1.0;
<a name="l00846"></a>00846       <span class="keywordflow">for</span> (<a class="code" href="classhdnum_1_1RE.html#ac69dd564f38accecac013e6fdfea00e1" title="export size_type">size_type</a> i=0; i&lt;solver.get_order(); i++) 
<a name="l00847"></a>00847         two_power_m *= 2.0;
<a name="l00848"></a>00848       TOL = <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a>(0.0001);
<a name="l00849"></a>00849       rho = <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a>(0.8);
<a name="l00850"></a>00850       alpha = <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a>(0.25);
<a name="l00851"></a>00851       beta = <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a>(4.0);
<a name="l00852"></a>00852       dt_min = 1E-12;
<a name="l00853"></a>00853     }
<a name="l00854"></a>00854 
<a name="l00856"></a><a class="code" href="classhdnum_1_1RE.html#aa08735eb2e917aaab79b516a89f40c97">00856</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1RE.html#aa08735eb2e917aaab79b516a89f40c97" title="set time step for subsequent steps">set_dt</a> (<a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a> dt_)
<a name="l00857"></a>00857     {
<a name="l00858"></a>00858       dt = dt_;
<a name="l00859"></a>00859     }
<a name="l00860"></a>00860 
<a name="l00862"></a><a class="code" href="classhdnum_1_1RE.html#a784627ea3d588d5ba0838832db4d2856">00862</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1RE.html#a784627ea3d588d5ba0838832db4d2856" title="set tolerance for adaptive computation">set_TOL</a> (<a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a> TOL_)
<a name="l00863"></a>00863     {
<a name="l00864"></a>00864       TOL = TOL_;
<a name="l00865"></a>00865     }
<a name="l00866"></a>00866 
<a name="l00868"></a><a class="code" href="classhdnum_1_1RE.html#a65c8908666fbe5773417155ec3fc5161">00868</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1RE.html#a65c8908666fbe5773417155ec3fc5161" title="do one step">step</a> ()
<a name="l00869"></a>00869     {
<a name="l00870"></a>00870       <span class="comment">// count steps done</span>
<a name="l00871"></a>00871       steps++;
<a name="l00872"></a>00872 
<a name="l00873"></a>00873       <span class="comment">// do 1 step with 2*dt</span>
<a name="l00874"></a>00874       <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a> H(2.0*dt);
<a name="l00875"></a>00875       solver.set_state(t,u);
<a name="l00876"></a>00876       solver.set_dt(H);
<a name="l00877"></a>00877       solver.step();
<a name="l00878"></a>00878       wlow = solver.get_state();
<a name="l00879"></a>00879 
<a name="l00880"></a>00880       <span class="comment">// do 2 steps with dt</span>
<a name="l00881"></a>00881       solver.set_state(t,u);
<a name="l00882"></a>00882       solver.set_dt(dt);
<a name="l00883"></a>00883       solver.step();
<a name="l00884"></a>00884       solver.step();
<a name="l00885"></a>00885       whigh = solver.get_state();
<a name="l00886"></a>00886 
<a name="l00887"></a>00887       <span class="comment">// estimate local error</span>
<a name="l00888"></a>00888       ww = wlow;
<a name="l00889"></a>00889       ww -= whigh;
<a name="l00890"></a>00890       <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a> error(norm(ww)/(pow(H,1.0+solver.get_order())*(1.0-1.0/two_power_m)));
<a name="l00891"></a>00891       <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a> dt_opt(pow(rho*TOL/error,1.0/((<a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a>)solver.get_order())));
<a name="l00892"></a>00892       dt_opt = std::min(beta*dt,std::max(alpha*dt,dt_opt));
<a name="l00893"></a>00893       <span class="comment">//std::cout &lt;&lt; &quot;est. error=&quot; &lt;&lt; error &lt;&lt; &quot; dt_opt=&quot; &lt;&lt; dt_opt &lt;&lt; std::endl;</span>
<a name="l00894"></a>00894 
<a name="l00895"></a>00895       <span class="keywordflow">if</span> (dt&lt;=dt_opt)
<a name="l00896"></a>00896         {
<a name="l00897"></a>00897           t += H;
<a name="l00898"></a>00898           u = whigh;
<a name="l00899"></a>00899           u *= two_power_m;
<a name="l00900"></a>00900           u -= wlow;
<a name="l00901"></a>00901           u /= two_power_m-1.0;
<a name="l00902"></a>00902           dt = dt_opt;
<a name="l00903"></a>00903         }
<a name="l00904"></a>00904       <span class="keywordflow">else</span>
<a name="l00905"></a>00905         {
<a name="l00906"></a>00906           rejected++;
<a name="l00907"></a>00907           dt = dt_opt;
<a name="l00908"></a>00908           <span class="keywordflow">if</span> (dt&gt;dt_min) <a class="code" href="classhdnum_1_1RE.html#a65c8908666fbe5773417155ec3fc5161" title="do one step">step</a>();
<a name="l00909"></a>00909         }
<a name="l00910"></a>00910     }
<a name="l00911"></a>00911 
<a name="l00913"></a><a class="code" href="classhdnum_1_1RE.html#a96ab38554c88dd93dcad6e64def6706b">00913</a>     <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; <a class="code" href="classhdnum_1_1RE.html#a96ab38554c88dd93dcad6e64def6706b" title="get current state">get_state</a> ()<span class="keyword"> const</span>
<a name="l00914"></a>00914 <span class="keyword">    </span>{
<a name="l00915"></a>00915       <span class="keywordflow">return</span> u;
<a name="l00916"></a>00916     }
<a name="l00917"></a>00917 
<a name="l00919"></a><a class="code" href="classhdnum_1_1RE.html#a81197d3660de7de56d85aa0f880ec9fa">00919</a>     <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1RE.html#a81197d3660de7de56d85aa0f880ec9fa" title="get current time">get_time</a> ()<span class="keyword"> const</span>
<a name="l00920"></a>00920 <span class="keyword">    </span>{
<a name="l00921"></a>00921       <span class="keywordflow">return</span> t;
<a name="l00922"></a>00922     }
<a name="l00923"></a>00923 
<a name="l00925"></a><a class="code" href="classhdnum_1_1RE.html#a7083da825790713eaa4bd69f179924f9">00925</a>     <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1RE.html#a7083da825790713eaa4bd69f179924f9" title="get dt used in last step (i.e. to compute current state)">get_dt</a> ()<span class="keyword"> const</span>
<a name="l00926"></a>00926 <span class="keyword">    </span>{
<a name="l00927"></a>00927       <span class="keywordflow">return</span> dt;
<a name="l00928"></a>00928     }
<a name="l00929"></a>00929 
<a name="l00931"></a><a class="code" href="classhdnum_1_1RE.html#a2eb79a70aef12f55b4aa34e09f4b8ad1">00931</a>     <a class="code" href="classhdnum_1_1RE.html#ac69dd564f38accecac013e6fdfea00e1" title="export size_type">size_type</a> <a class="code" href="classhdnum_1_1RE.html#a2eb79a70aef12f55b4aa34e09f4b8ad1" title="return consistency order of the method">get_order</a> ()<span class="keyword"> const</span>
<a name="l00932"></a>00932 <span class="keyword">    </span>{
<a name="l00933"></a>00933       <span class="keywordflow">return</span> solver.get_order()+1;
<a name="l00934"></a>00934     }
<a name="l00935"></a>00935 
<a name="l00937"></a><a class="code" href="classhdnum_1_1RE.html#aae44debd78eaf94003a076920444f79b">00937</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1RE.html#aae44debd78eaf94003a076920444f79b" title="print some information">get_info</a> ()<span class="keyword"> const</span>
<a name="l00938"></a>00938 <span class="keyword">    </span>{
<a name="l00939"></a>00939       std::cout &lt;&lt; <span class="stringliteral">&quot;RE: steps=&quot;</span> &lt;&lt; steps &lt;&lt; <span class="stringliteral">&quot; rejected=&quot;</span> &lt;&lt; rejected &lt;&lt; std::endl;
<a name="l00940"></a>00940     }
<a name="l00941"></a>00941     
<a name="l00942"></a>00942   <span class="keyword">private</span>:
<a name="l00943"></a>00943     <span class="keyword">const</span> M&amp; model;
<a name="l00944"></a>00944     S&amp; solver;
<a name="l00945"></a>00945     <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a> t, dt;
<a name="l00946"></a>00946     <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a> two_power_m;
<a name="l00947"></a>00947     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> u,wlow,whigh,ww;
<a name="l00948"></a>00948     <a class="code" href="classhdnum_1_1RE.html#ae91da4bd459d3c8961c678e9ea53cdc7" title="export time_type">time_type</a> TOL,rho,alpha,beta,dt_min;
<a name="l00949"></a>00949     <span class="keyword">mutable</span> <a class="code" href="classhdnum_1_1RE.html#ac69dd564f38accecac013e6fdfea00e1" title="export size_type">size_type</a> steps, rejected;
<a name="l00950"></a>00950   };
<a name="l00951"></a>00951 
<a name="l00952"></a>00952 
<a name="l00962"></a>00962   <span class="keyword">template</span>&lt;<span class="keyword">class</span> M, <span class="keyword">class</span> S&gt;
<a name="l00963"></a><a class="code" href="classhdnum_1_1IE.html">00963</a>   <span class="keyword">class </span><a class="code" href="classhdnum_1_1IE.html" title="Implicit Euler using Newton&amp;#39;s method to solve nonlinear system.">IE</a>
<a name="l00964"></a>00964   {
<a name="l00966"></a>00966     <span class="comment">// h_n f(t_n, y_n) - y_n + y_{n-1} = 0</span>
<a name="l00967"></a>00967     <span class="keyword">class </span>NonlinearProblem
<a name="l00968"></a>00968     {
<a name="l00969"></a>00969     <span class="keyword">public</span>:
<a name="l00971"></a>00971       <span class="keyword">typedef</span> <span class="keyword">typename</span> M::size_type <a class="code" href="classhdnum_1_1IE.html#af2d3dd8c57bb78dfd28a613dd11f499a" title="export size_type">size_type</a>;
<a name="l00972"></a>00972       
<a name="l00974"></a>00974       <span class="keyword">typedef</span> <span class="keyword">typename</span> M::number_type <a class="code" href="classhdnum_1_1IE.html#a23de7a983f5419c37d8530d49cab4913" title="export number_type">number_type</a>;
<a name="l00975"></a>00975 
<a name="l00977"></a>00977       NonlinearProblem (<span class="keyword">const</span> M&amp; model_, <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; yold_, 
<a name="l00978"></a>00978                         <span class="keyword">typename</span> M::time_type tnew_, <span class="keyword">typename</span> M::time_type dt_)
<a name="l00979"></a>00979         : model(model_), yold(yold_), tnew(tnew_), dt(dt_)
<a name="l00980"></a>00980       {}
<a name="l00981"></a>00981 
<a name="l00983"></a>00983       std::size_t size ()<span class="keyword"> const</span>
<a name="l00984"></a>00984 <span class="keyword">      </span>{
<a name="l00985"></a>00985         <span class="keywordflow">return</span> model.size();
<a name="l00986"></a>00986       }
<a name="l00987"></a>00987 
<a name="l00989"></a>00989       <span class="keywordtype">void</span> F (<span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; x, <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; result)<span class="keyword"> const</span>
<a name="l00990"></a>00990 <span class="keyword">      </span>{
<a name="l00991"></a>00991         model.f(tnew,x,result);
<a name="l00992"></a>00992         result *= dt;
<a name="l00993"></a>00993         result -= x;
<a name="l00994"></a>00994         result += yold;
<a name="l00995"></a>00995       }
<a name="l00996"></a>00996 
<a name="l00998"></a>00998       <span class="keywordtype">void</span> F_x (<span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; x, <a class="code" href="classhdnum_1_1Matrix.html">Matrix&lt;number_type&gt;</a>&amp; result)<span class="keyword"> const</span>
<a name="l00999"></a>00999 <span class="keyword">      </span>{
<a name="l01000"></a>01000         model.f_x(tnew,x,result);
<a name="l01001"></a>01001         result *= dt;
<a name="l01002"></a>01002         <span class="keywordflow">for</span> (<a class="code" href="classhdnum_1_1IE.html#af2d3dd8c57bb78dfd28a613dd11f499a" title="export size_type">size_type</a> i=0; i&lt;model.size(); i++) result[i][i] -= <a class="code" href="classhdnum_1_1IE.html#a23de7a983f5419c37d8530d49cab4913" title="export number_type">number_type</a>(1.0);
<a name="l01003"></a>01003       }
<a name="l01004"></a>01004 
<a name="l01005"></a>01005       <span class="keywordtype">void</span> set_tnew_dt (<span class="keyword">typename</span> M::time_type tnew_, <span class="keyword">typename</span> M::time_type dt_)
<a name="l01006"></a>01006       {
<a name="l01007"></a>01007         tnew = tnew_;
<a name="l01008"></a>01008         dt = dt_;
<a name="l01009"></a>01009       }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011     <span class="keyword">private</span>:
<a name="l01012"></a>01012       <span class="keyword">const</span> M&amp; model;
<a name="l01013"></a>01013       <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; yold;
<a name="l01014"></a>01014       <span class="keyword">typename</span> M::time_type tnew;
<a name="l01015"></a>01015       <span class="keyword">typename</span> M::time_type dt;
<a name="l01016"></a>01016     };
<a name="l01017"></a>01017 
<a name="l01018"></a>01018   <span class="keyword">public</span>:
<a name="l01020"></a><a class="code" href="classhdnum_1_1IE.html#af2d3dd8c57bb78dfd28a613dd11f499a">01020</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::size_type <a class="code" href="classhdnum_1_1IE.html#af2d3dd8c57bb78dfd28a613dd11f499a" title="export size_type">size_type</a>;
<a name="l01021"></a>01021 
<a name="l01023"></a><a class="code" href="classhdnum_1_1IE.html#a4a58f86ec61809cbca7b16922dcbb39e">01023</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::time_type <a class="code" href="classhdnum_1_1IE.html#a4a58f86ec61809cbca7b16922dcbb39e" title="export time_type">time_type</a>;
<a name="l01024"></a>01024 
<a name="l01026"></a><a class="code" href="classhdnum_1_1IE.html#a23de7a983f5419c37d8530d49cab4913">01026</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::number_type <a class="code" href="classhdnum_1_1IE.html#a23de7a983f5419c37d8530d49cab4913" title="export number_type">number_type</a>;
<a name="l01027"></a>01027 
<a name="l01029"></a><a class="code" href="classhdnum_1_1IE.html#a25d8827c46865a4b6dae56a07b70f507">01029</a>     <a class="code" href="classhdnum_1_1IE.html#a25d8827c46865a4b6dae56a07b70f507" title="constructor stores reference to the model">IE</a> (<span class="keyword">const</span> M&amp; model_, <span class="keyword">const</span> S&amp; newton_)
<a name="l01030"></a>01030       : verbosity(0), model(model_), newton(newton_), u(model.size()), unew(model.size())
<a name="l01031"></a>01031     {
<a name="l01032"></a>01032       model.initialize(t,u);
<a name="l01033"></a>01033       dt = dtmax = 0.1; 
<a name="l01034"></a>01034     }
<a name="l01035"></a>01035 
<a name="l01037"></a><a class="code" href="classhdnum_1_1IE.html#a26bfa23447038750257ecdf75d341283">01037</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1IE.html#a26bfa23447038750257ecdf75d341283" title="set time step for subsequent steps">set_dt</a> (<a class="code" href="classhdnum_1_1IE.html#a4a58f86ec61809cbca7b16922dcbb39e" title="export time_type">time_type</a> dt_)
<a name="l01038"></a>01038     {
<a name="l01039"></a>01039       dt = dtmax = dt_;
<a name="l01040"></a>01040     }
<a name="l01041"></a>01041 
<a name="l01043"></a><a class="code" href="classhdnum_1_1IE.html#a3ece1463453f15fe247c030e487ea232">01043</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1IE.html#a3ece1463453f15fe247c030e487ea232" title="set verbosity level">set_verbosity</a> (<a class="code" href="classhdnum_1_1IE.html#af2d3dd8c57bb78dfd28a613dd11f499a" title="export size_type">size_type</a> verbosity_)
<a name="l01044"></a>01044     {
<a name="l01045"></a>01045       verbosity = verbosity_;
<a name="l01046"></a>01046     }
<a name="l01047"></a>01047 
<a name="l01049"></a><a class="code" href="classhdnum_1_1IE.html#a947a239a2ddfe6d3f946db28f04a900d">01049</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1IE.html#a947a239a2ddfe6d3f946db28f04a900d" title="do one step">step</a> ()
<a name="l01050"></a>01050     {
<a name="l01051"></a>01051       <span class="keywordflow">if</span> (verbosity&gt;=2) 
<a name="l01052"></a>01052         std::cout &lt;&lt; <span class="stringliteral">&quot;IE: step&quot;</span> &lt;&lt; <span class="stringliteral">&quot; t=&quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot; dt=&quot;</span> &lt;&lt; dt &lt;&lt; std::endl;
<a name="l01053"></a>01053       NonlinearProblem nlp(model,u,t+dt,dt);
<a name="l01054"></a>01054       <span class="keywordtype">bool</span> reduced = <span class="keyword">false</span>;
<a name="l01055"></a>01055       error = <span class="keyword">false</span>;
<a name="l01056"></a>01056       <span class="keywordflow">while</span> (1)
<a name="l01057"></a>01057         {
<a name="l01058"></a>01058           unew = u;
<a name="l01059"></a>01059           newton.solve(nlp,unew);
<a name="l01060"></a>01060           <span class="keywordflow">if</span> (newton.has_converged())
<a name="l01061"></a>01061             {
<a name="l01062"></a>01062               u = unew;
<a name="l01063"></a>01063               t += dt;
<a name="l01064"></a>01064               <span class="keywordflow">if</span> (!reduced &amp;&amp; dt&lt;dtmax-1e-13)
<a name="l01065"></a>01065                 {
<a name="l01066"></a>01066                   dt = std::min(2.0*dt,dtmax);
<a name="l01067"></a>01067                   <span class="keywordflow">if</span> (verbosity&gt;0) 
<a name="l01068"></a>01068                     std::cout &lt;&lt; <span class="stringliteral">&quot;IE: increasing time step to &quot;</span> &lt;&lt; dt &lt;&lt; std::endl;
<a name="l01069"></a>01069                 }
<a name="l01070"></a>01070               <span class="keywordflow">return</span>;
<a name="l01071"></a>01071             }
<a name="l01072"></a>01072           <span class="keywordflow">else</span>
<a name="l01073"></a>01073             {
<a name="l01074"></a>01074               <span class="keywordflow">if</span> (dt&lt;1e-12)
<a name="l01075"></a>01075                 {
<a name="l01076"></a>01076                   HDNUM_ERROR(<span class="stringliteral">&quot;time step too small in implicit Euler&quot;</span>);
<a name="l01077"></a>01077                   error = <span class="keyword">true</span>;
<a name="l01078"></a>01078                   <span class="keywordflow">break</span>;
<a name="l01079"></a>01079                 }
<a name="l01080"></a>01080               dt *= 0.5;
<a name="l01081"></a>01081               reduced = <span class="keyword">true</span>;
<a name="l01082"></a>01082               nlp.set_tnew_dt(t+dt,dt);
<a name="l01083"></a>01083               <span class="keywordflow">if</span> (verbosity&gt;0) std::cout &lt;&lt; <span class="stringliteral">&quot;IE: reducing time step to &quot;</span> &lt;&lt; dt &lt;&lt; std::endl;
<a name="l01084"></a>01084             }
<a name="l01085"></a>01085         }
<a name="l01086"></a>01086     }
<a name="l01087"></a>01087 
<a name="l01089"></a><a class="code" href="classhdnum_1_1IE.html#a69b53dd12e5b00739b26551102c090bb">01089</a>     <span class="keywordtype">bool</span> <a class="code" href="classhdnum_1_1IE.html#a69b53dd12e5b00739b26551102c090bb" title="get current state">get_error</a> ()<span class="keyword"> const</span>
<a name="l01090"></a>01090 <span class="keyword">    </span>{
<a name="l01091"></a>01091       <span class="keywordflow">return</span> error;
<a name="l01092"></a>01092     }
<a name="l01093"></a>01093 
<a name="l01095"></a><a class="code" href="classhdnum_1_1IE.html#aa333a60e09305968c3ae333a06c5abd4">01095</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1IE.html#aa333a60e09305968c3ae333a06c5abd4" title="set current state">set_state</a> (<a class="code" href="classhdnum_1_1IE.html#a4a58f86ec61809cbca7b16922dcbb39e" title="export time_type">time_type</a> t_, <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; u_)
<a name="l01096"></a>01096     {
<a name="l01097"></a>01097       t = t_;
<a name="l01098"></a>01098       u = u_;
<a name="l01099"></a>01099     }
<a name="l01100"></a>01100 
<a name="l01102"></a><a class="code" href="classhdnum_1_1IE.html#a7c9b9284e27f01f67f776f7e6b5c4cf7">01102</a>     <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; <a class="code" href="classhdnum_1_1IE.html#a7c9b9284e27f01f67f776f7e6b5c4cf7" title="get current state">get_state</a> ()<span class="keyword"> const</span>
<a name="l01103"></a>01103 <span class="keyword">    </span>{
<a name="l01104"></a>01104       <span class="keywordflow">return</span> u;
<a name="l01105"></a>01105     }
<a name="l01106"></a>01106 
<a name="l01108"></a><a class="code" href="classhdnum_1_1IE.html#a2abb282e43dc676c2b192f49e732986a">01108</a>     <a class="code" href="classhdnum_1_1IE.html#a4a58f86ec61809cbca7b16922dcbb39e" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1IE.html#a2abb282e43dc676c2b192f49e732986a" title="get current time">get_time</a> ()<span class="keyword"> const</span>
<a name="l01109"></a>01109 <span class="keyword">    </span>{
<a name="l01110"></a>01110       <span class="keywordflow">return</span> t;
<a name="l01111"></a>01111     }
<a name="l01112"></a>01112 
<a name="l01114"></a><a class="code" href="classhdnum_1_1IE.html#aeaea0a1cdee7135d0e85e980c4f15179">01114</a>     <a class="code" href="classhdnum_1_1IE.html#a4a58f86ec61809cbca7b16922dcbb39e" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1IE.html#aeaea0a1cdee7135d0e85e980c4f15179" title="get dt used in last step (i.e. to compute current state)">get_dt</a> ()<span class="keyword"> const</span>
<a name="l01115"></a>01115 <span class="keyword">    </span>{
<a name="l01116"></a>01116       <span class="keywordflow">return</span> dt;
<a name="l01117"></a>01117     }
<a name="l01118"></a>01118 
<a name="l01120"></a><a class="code" href="classhdnum_1_1IE.html#acbc50aab0984aa2fc0d59ad02fb530fb">01120</a>     <a class="code" href="classhdnum_1_1IE.html#af2d3dd8c57bb78dfd28a613dd11f499a" title="export size_type">size_type</a> <a class="code" href="classhdnum_1_1IE.html#acbc50aab0984aa2fc0d59ad02fb530fb" title="return consistency order of the method">get_order</a> ()<span class="keyword"> const</span>
<a name="l01121"></a>01121 <span class="keyword">    </span>{
<a name="l01122"></a>01122       <span class="keywordflow">return</span> 1;
<a name="l01123"></a>01123     }
<a name="l01124"></a>01124     
<a name="l01126"></a><a class="code" href="classhdnum_1_1IE.html#ac0cc9141ec0c29ea465ffc4b416a52a8">01126</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1IE.html#ac0cc9141ec0c29ea465ffc4b416a52a8" title="print some information">get_info</a> ()<span class="keyword"> const</span>
<a name="l01127"></a>01127 <span class="keyword">    </span>{
<a name="l01128"></a>01128     }
<a name="l01129"></a>01129 
<a name="l01130"></a>01130   <span class="keyword">private</span>:
<a name="l01131"></a>01131     <a class="code" href="classhdnum_1_1IE.html#af2d3dd8c57bb78dfd28a613dd11f499a" title="export size_type">size_type</a> verbosity;
<a name="l01132"></a>01132     <span class="keyword">const</span> M&amp; model;
<a name="l01133"></a>01133     <span class="keyword">const</span> S&amp; newton;
<a name="l01134"></a>01134     <a class="code" href="classhdnum_1_1IE.html#a4a58f86ec61809cbca7b16922dcbb39e" title="export time_type">time_type</a> t, dt, dtmax;
<a name="l01135"></a>01135     <a class="code" href="classhdnum_1_1IE.html#a23de7a983f5419c37d8530d49cab4913" title="export number_type">number_type</a> reduction;
<a name="l01136"></a>01136     <a class="code" href="classhdnum_1_1IE.html#af2d3dd8c57bb78dfd28a613dd11f499a" title="export size_type">size_type</a> linesearchsteps;
<a name="l01137"></a>01137     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> u;
<a name="l01138"></a>01138     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> unew;
<a name="l01139"></a>01139     <span class="keyword">mutable</span> <span class="keywordtype">bool</span> error;
<a name="l01140"></a>01140   };
<a name="l01141"></a>01141 
<a name="l01152"></a>01152   <span class="keyword">template</span>&lt;<span class="keyword">class</span> M, <span class="keyword">class</span> S&gt;
<a name="l01153"></a><a class="code" href="classhdnum_1_1DIRK.html">01153</a>   <span class="keyword">class </span><a class="code" href="classhdnum_1_1DIRK.html" title="Implementation of a general Diagonal Implicit Runge-Kutta method.">DIRK</a>
<a name="l01154"></a>01154   {
<a name="l01155"></a>01155   <span class="keyword">public</span>:
<a name="l01156"></a>01156 
<a name="l01158"></a><a class="code" href="classhdnum_1_1DIRK.html#a80ab2ad1360bc6061cea64d7a5ca9d12">01158</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::size_type <a class="code" href="classhdnum_1_1DIRK.html#a80ab2ad1360bc6061cea64d7a5ca9d12" title="export size_type">size_type</a>;
<a name="l01159"></a>01159 
<a name="l01161"></a><a class="code" href="classhdnum_1_1DIRK.html#a91204fa2e007b5eed35034bfe409037b">01161</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::time_type <a class="code" href="classhdnum_1_1DIRK.html#a91204fa2e007b5eed35034bfe409037b" title="export time_type">time_type</a>;
<a name="l01162"></a>01162 
<a name="l01164"></a><a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183">01164</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> M::number_type <a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183" title="export number_type">number_type</a>;
<a name="l01165"></a>01165 
<a name="l01167"></a><a class="code" href="classhdnum_1_1DIRK.html#ac086e9474953dd982e3192f892039d67">01167</a>     <span class="keyword">typedef</span> <a class="code" href="classhdnum_1_1Matrix.html">Matrix&lt;number_type&gt;</a> <a class="code" href="classhdnum_1_1Matrix.html">ButcherTableau</a>;
<a name="l01168"></a>01168 
<a name="l01169"></a>01169   <span class="keyword">private</span>:
<a name="l01170"></a>01170 
<a name="l01173"></a>01173     <span class="keyword">static</span> <a class="code" href="classhdnum_1_1Matrix.html">ButcherTableau</a> initTableau(<span class="keyword">const</span> std::string method)
<a name="l01174"></a>01174     {
<a name="l01175"></a>01175       <span class="keywordflow">if</span>(method.find(<span class="stringliteral">&quot;Implicit Euler&quot;</span>) != std::string::npos){
<a name="l01176"></a>01176         <a class="code" href="classhdnum_1_1Matrix.html">ButcherTableau</a> butcher(2,2,0.0);
<a name="l01177"></a>01177         butcher[1][1] = 1;
<a name="l01178"></a>01178         butcher[0][1] = 1;
<a name="l01179"></a>01179         butcher[0][0] = 1;
<a name="l01180"></a>01180 
<a name="l01181"></a>01181         <span class="keywordflow">return</span> butcher;
<a name="l01182"></a>01182       }
<a name="l01183"></a>01183       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(method.find(<span class="stringliteral">&quot;Alexander&quot;</span>) != std::string::npos){
<a name="l01184"></a>01184         <a class="code" href="classhdnum_1_1Matrix.html">ButcherTableau</a> butcher(3,3,0.0);
<a name="l01185"></a>01185         <span class="keyword">const</span> <a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183" title="export number_type">number_type</a> alpha = 1. - sqrt(2.)/2.;
<a name="l01186"></a>01186         butcher[0][0] = alpha;
<a name="l01187"></a>01187         butcher[0][1] = alpha;
<a name="l01188"></a>01188 
<a name="l01189"></a>01189         butcher[1][0] = 1.;
<a name="l01190"></a>01190         butcher[1][1] = 1. - alpha;
<a name="l01191"></a>01191         butcher[1][2] = alpha;
<a name="l01192"></a>01192 
<a name="l01193"></a>01193         butcher[2][1] = 1. - alpha;
<a name="l01194"></a>01194         butcher[2][2] = alpha;
<a name="l01195"></a>01195 
<a name="l01196"></a>01196         <span class="keywordflow">return</span> butcher;
<a name="l01197"></a>01197       }
<a name="l01198"></a>01198       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(method.find(<span class="stringliteral">&quot;Crouzieux&quot;</span>) != std::string::npos){
<a name="l01199"></a>01199         <a class="code" href="classhdnum_1_1Matrix.html">ButcherTableau</a> butcher(3,3,0.0);
<a name="l01200"></a>01200         <span class="keyword">const</span> <a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183" title="export number_type">number_type</a> beta = 1./2./sqrt(3);
<a name="l01201"></a>01201         butcher[0][0] = 0.5 + beta;
<a name="l01202"></a>01202         butcher[0][1] = 0.5 + beta;
<a name="l01203"></a>01203 
<a name="l01204"></a>01204         butcher[1][0] = 0.5 - beta;
<a name="l01205"></a>01205         butcher[1][1] = -1. / sqrt(3);
<a name="l01206"></a>01206         butcher[1][2] = 0.5 + beta;
<a name="l01207"></a>01207 
<a name="l01208"></a>01208         butcher[2][1] = 0.5;
<a name="l01209"></a>01209         butcher[2][2] = 0.5;
<a name="l01210"></a>01210 
<a name="l01211"></a>01211         <span class="keywordflow">return</span> butcher;
<a name="l01212"></a>01212       }
<a name="l01213"></a>01213       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(method.find(<span class="stringliteral">&quot;Midpoint Rule&quot;</span>) != std::string::npos){
<a name="l01214"></a>01214         <a class="code" href="classhdnum_1_1Matrix.html">ButcherTableau</a> butcher(2,2,0.0);
<a name="l01215"></a>01215         butcher[0][0] = 0.5;
<a name="l01216"></a>01216         butcher[0][1] = 0.5;
<a name="l01217"></a>01217         butcher[1][1] = 1;
<a name="l01218"></a>01218 
<a name="l01219"></a>01219         <span class="keywordflow">return</span> butcher;
<a name="l01220"></a>01220       }
<a name="l01221"></a>01221       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(method.find(<span class="stringliteral">&quot;Fractional Step Theta&quot;</span>) != std::string::npos){
<a name="l01222"></a>01222         <a class="code" href="classhdnum_1_1Matrix.html">ButcherTableau</a> butcher(5,5,0.0);
<a name="l01223"></a>01223         <span class="keyword">const</span> <a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183" title="export number_type">number_type</a> theta = 1 - sqrt(2.)/2.;
<a name="l01224"></a>01224         <span class="keyword">const</span> <a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183" title="export number_type">number_type</a> alpha = 2. - sqrt(2.);
<a name="l01225"></a>01225         <span class="keyword">const</span> <a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183" title="export number_type">number_type</a> beta = 1. - alpha;
<a name="l01226"></a>01226         butcher[1][0] = theta;
<a name="l01227"></a>01227         butcher[1][1] = beta * theta;
<a name="l01228"></a>01228         butcher[1][2] = alpha * theta;
<a name="l01229"></a>01229 
<a name="l01230"></a>01230         butcher[2][0] = 1.-theta;
<a name="l01231"></a>01231         butcher[2][1] = beta * theta;
<a name="l01232"></a>01232         butcher[2][2] = alpha * (1.-theta);
<a name="l01233"></a>01233         butcher[2][3] = alpha * theta;
<a name="l01234"></a>01234 
<a name="l01235"></a>01235         butcher[3][0] = 1.;
<a name="l01236"></a>01236         butcher[3][1] = beta * theta;
<a name="l01237"></a>01237         butcher[3][2] = alpha * (1.-theta);
<a name="l01238"></a>01238         butcher[3][3] = (alpha + beta) * theta;
<a name="l01239"></a>01239         butcher[3][4] = alpha * theta;
<a name="l01240"></a>01240 
<a name="l01241"></a>01241         butcher[4][1] = beta * theta;
<a name="l01242"></a>01242         butcher[4][2] = alpha * (1.-theta);
<a name="l01243"></a>01243         butcher[4][3] = (alpha + beta) * theta;
<a name="l01244"></a>01244         butcher[4][4] = alpha * theta;
<a name="l01245"></a>01245 
<a name="l01246"></a>01246         <span class="keywordflow">return</span> butcher;
<a name="l01247"></a>01247       }
<a name="l01248"></a>01248       <span class="keywordflow">else</span>{
<a name="l01249"></a>01249         HDNUM_ERROR(<span class="stringliteral">&quot;Order not available for Runge Kutta solver.&quot;</span>);
<a name="l01250"></a>01250       }
<a name="l01251"></a>01251     }
<a name="l01252"></a>01252 
<a name="l01253"></a>01253     <span class="keyword">static</span> <span class="keywordtype">int</span> initOrder(<span class="keyword">const</span> std::string method)
<a name="l01254"></a>01254     {
<a name="l01255"></a>01255       <span class="keywordflow">if</span>(method.find(<span class="stringliteral">&quot;Implicit Euler&quot;</span>) != std::string::npos){
<a name="l01256"></a>01256         <span class="keywordflow">return</span> 1;
<a name="l01257"></a>01257       }
<a name="l01258"></a>01258       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(method.find(<span class="stringliteral">&quot;Alexander&quot;</span>) != std::string::npos){
<a name="l01259"></a>01259         <span class="keywordflow">return</span> 2;
<a name="l01260"></a>01260       }
<a name="l01261"></a>01261       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(method.find(<span class="stringliteral">&quot;Crouzieux&quot;</span>) != std::string::npos){
<a name="l01262"></a>01262         <span class="keywordflow">return</span> 3;
<a name="l01263"></a>01263       }
<a name="l01264"></a>01264       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(method.find(<span class="stringliteral">&quot;Midpoint Rule&quot;</span>) != std::string::npos){
<a name="l01265"></a>01265         <span class="keywordflow">return</span> 2;
<a name="l01266"></a>01266       }
<a name="l01267"></a>01267       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(method.find(<span class="stringliteral">&quot;Fractional Step Theta&quot;</span>) != std::string::npos){
<a name="l01268"></a>01268         <span class="keywordflow">return</span> 2;
<a name="l01269"></a>01269       }
<a name="l01270"></a>01270       <span class="keywordflow">else</span>{
<a name="l01271"></a>01271         HDNUM_ERROR(<span class="stringliteral">&quot;Order not available for Runge Kutta solver.&quot;</span>);
<a name="l01272"></a>01272       }
<a name="l01273"></a>01273     }
<a name="l01274"></a>01274     
<a name="l01275"></a>01275 
<a name="l01277"></a>01277     <span class="comment">// h_n f(t_n, y_n) - y_n + y_{n-1} = 0</span>
<a name="l01278"></a>01278     <span class="keyword">class </span>NonlinearProblem
<a name="l01279"></a>01279     {
<a name="l01280"></a>01280     <span class="keyword">public</span>:
<a name="l01282"></a>01282       <span class="keyword">typedef</span> <span class="keyword">typename</span> M::size_type <a class="code" href="classhdnum_1_1DIRK.html#a80ab2ad1360bc6061cea64d7a5ca9d12" title="export size_type">size_type</a>;
<a name="l01283"></a>01283       
<a name="l01285"></a>01285       <span class="keyword">typedef</span> <span class="keyword">typename</span> M::number_type <a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183" title="export number_type">number_type</a>;
<a name="l01286"></a>01286 
<a name="l01288"></a>01288       NonlinearProblem (<span class="keyword">const</span> M&amp; model_, <span class="keyword">const</span> Vector&lt;number_type&gt;&amp; yold_, 
<a name="l01289"></a>01289                         <span class="keyword">typename</span> M::time_type told_, <span class="keyword">typename</span> M::time_type dt_,
<a name="l01290"></a>01290                         <span class="keyword">const</span> <a class="code" href="classhdnum_1_1DIRK.html#ac086e9474953dd982e3192f892039d67" title="the type of a Butcher tableau">ButcherTableau</a> &amp; butcher_, <span class="keyword">const</span> <span class="keywordtype">int</span> rk_step_,
<a name="l01291"></a>01291                         <span class="keyword">const</span> std::vector&lt; Vector&lt;number_type&gt; &gt; &amp; k_)
<a name="l01292"></a>01292         : model(model_), yold(yold_), told(told_), 
<a name="l01293"></a>01293           dt(dt_), butcher(butcher_), rk_step(rk_step_), k_old(model.size(),0)
<a name="l01294"></a>01294       {
<a name="l01295"></a>01295         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;rk_step; ++i)
<a name="l01296"></a>01296           k_old.update(butcher[rk_step][1+i] * dt, k_[i]);
<a name="l01297"></a>01297       }
<a name="l01298"></a>01298 
<a name="l01300"></a>01300       std::size_t size ()<span class="keyword"> const</span>
<a name="l01301"></a>01301 <span class="keyword">      </span>{
<a name="l01302"></a>01302         <span class="keywordflow">return</span> model.size();
<a name="l01303"></a>01303       }
<a name="l01304"></a>01304 
<a name="l01306"></a>01306       <span class="keywordtype">void</span> F (<span class="keyword">const</span> Vector&lt;number_type&gt;&amp; x, Vector&lt;number_type&gt;&amp; result)<span class="keyword"> const</span>
<a name="l01307"></a>01307 <span class="keyword">      </span>{
<a name="l01308"></a>01308         result = k_old;
<a name="l01309"></a>01309 
<a name="l01310"></a>01310         Vector&lt;number_type&gt; current_z(x);
<a name="l01311"></a>01311         current_z.update(1.,yold);
<a name="l01312"></a>01312 
<a name="l01313"></a>01313         <span class="keyword">const</span> <a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183" title="export number_type">number_type</a> tnew = told + butcher[rk_step][0] * dt;
<a name="l01314"></a>01314 
<a name="l01315"></a>01315         Vector&lt;number_type&gt; current_k(model.size(),0.);
<a name="l01316"></a>01316         model.f(tnew,current_z,current_k);
<a name="l01317"></a>01317         result.update(butcher[rk_step][rk_step+1] * dt, current_k);
<a name="l01318"></a>01318 
<a name="l01319"></a>01319         result.update(-1.,x);
<a name="l01320"></a>01320       }
<a name="l01321"></a>01321 
<a name="l01323"></a>01323       <span class="keywordtype">void</span> F_x (<span class="keyword">const</span> Vector&lt;number_type&gt;&amp; x, Matrix&lt;number_type&gt;&amp; result)<span class="keyword"> const</span>
<a name="l01324"></a>01324 <span class="keyword">      </span>{
<a name="l01325"></a>01325         <span class="keyword">const</span> <a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183" title="export number_type">number_type</a> tnew = told + butcher[rk_step][0] * dt;
<a name="l01326"></a>01326 
<a name="l01327"></a>01327         Vector&lt;number_type&gt; current_z(x);
<a name="l01328"></a>01328         current_z.update(1.,yold);
<a name="l01329"></a>01329 
<a name="l01330"></a>01330         model.f_x(tnew,current_z,result);
<a name="l01331"></a>01331 
<a name="l01332"></a>01332         result *= dt * butcher[rk_step][rk_step+1];
<a name="l01333"></a>01333 
<a name="l01334"></a>01334         <span class="keywordflow">for</span> (<a class="code" href="classhdnum_1_1DIRK.html#a80ab2ad1360bc6061cea64d7a5ca9d12" title="export size_type">size_type</a> i=0; i&lt;model.size(); i++) result[i][i] -= <a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183" title="export number_type">number_type</a>(1.0);
<a name="l01335"></a>01335       }
<a name="l01336"></a>01336 
<a name="l01337"></a>01337       <span class="keywordtype">void</span> set_told_dt (<span class="keyword">typename</span> M::time_type told_, <span class="keyword">typename</span> M::time_type dt_)
<a name="l01338"></a>01338       {
<a name="l01339"></a>01339         told = told_;
<a name="l01340"></a>01340         dt = dt_;
<a name="l01341"></a>01341       }
<a name="l01342"></a>01342 
<a name="l01343"></a>01343     <span class="keyword">private</span>:
<a name="l01344"></a>01344       <span class="keyword">const</span> M&amp; model;
<a name="l01345"></a>01345       <span class="keyword">const</span> Vector&lt;number_type&gt;&amp; yold;
<a name="l01346"></a>01346       <span class="keyword">typename</span> M::time_type told;
<a name="l01347"></a>01347       <span class="keyword">typename</span> M::time_type dt;
<a name="l01348"></a>01348       <span class="keyword">const</span> <a class="code" href="classhdnum_1_1DIRK.html#ac086e9474953dd982e3192f892039d67" title="the type of a Butcher tableau">ButcherTableau</a> &amp; butcher;
<a name="l01349"></a>01349       <span class="keyword">const</span> <span class="keywordtype">int</span> rk_step;
<a name="l01350"></a>01350       Vector&lt;number_type&gt; k_old;
<a name="l01351"></a>01351     };
<a name="l01352"></a>01352 
<a name="l01353"></a>01353   <span class="keyword">public</span>:
<a name="l01354"></a>01354 
<a name="l01357"></a><a class="code" href="classhdnum_1_1DIRK.html#a4c6a823702e9e8b885cd4b81be861d51">01357</a>     <a class="code" href="classhdnum_1_1DIRK.html#a4c6a823702e9e8b885cd4b81be861d51">DIRK</a> (<span class="keyword">const</span> M&amp; model_, <span class="keyword">const</span> S&amp; newton_, <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Matrix.html">ButcherTableau</a> &amp; butcher_, <span class="keyword">const</span> <span class="keywordtype">int</span> order_)
<a name="l01358"></a>01358       : verbosity(0), butcher(butcher_), model(model_), newton(newton_), 
<a name="l01359"></a>01359         u(model.size()), order(order_)
<a name="l01360"></a>01360     {
<a name="l01361"></a>01361       model.initialize(t,u);
<a name="l01362"></a>01362       dt = dtmax = 0.1; 
<a name="l01363"></a>01363     }
<a name="l01364"></a>01364 
<a name="l01367"></a><a class="code" href="classhdnum_1_1DIRK.html#ab914c53100346697592513bdae05c668">01367</a>     <a class="code" href="classhdnum_1_1DIRK.html#a4c6a823702e9e8b885cd4b81be861d51">DIRK</a> (<span class="keyword">const</span> M&amp; model_, <span class="keyword">const</span> S&amp; newton_, <span class="keyword">const</span> std::string method)
<a name="l01368"></a>01368       : verbosity(0), butcher(initTableau(method)), model(model_), newton(newton_), u(model.size()),
<a name="l01369"></a>01369         order(initOrder(method))
<a name="l01370"></a>01370     {
<a name="l01371"></a>01371       model.initialize(t,u);
<a name="l01372"></a>01372       dt = dtmax = 0.1; 
<a name="l01373"></a>01373     }
<a name="l01374"></a>01374 
<a name="l01375"></a>01375 
<a name="l01377"></a><a class="code" href="classhdnum_1_1DIRK.html#a425388f8d85dac93e59155ff6e4b8578">01377</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1DIRK.html#a425388f8d85dac93e59155ff6e4b8578" title="set time step for subsequent steps">set_dt</a> (<a class="code" href="classhdnum_1_1DIRK.html#a91204fa2e007b5eed35034bfe409037b" title="export time_type">time_type</a> dt_)
<a name="l01378"></a>01378     {
<a name="l01379"></a>01379       dt = dtmax = dt_;
<a name="l01380"></a>01380     }
<a name="l01381"></a>01381 
<a name="l01383"></a><a class="code" href="classhdnum_1_1DIRK.html#ab32055e261f7b4dd49b5458d33e7abe5">01383</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1DIRK.html#ab32055e261f7b4dd49b5458d33e7abe5" title="set verbosity level">set_verbosity</a> (<a class="code" href="classhdnum_1_1DIRK.html#a80ab2ad1360bc6061cea64d7a5ca9d12" title="export size_type">size_type</a> verbosity_)
<a name="l01384"></a>01384     {
<a name="l01385"></a>01385       verbosity = verbosity_;
<a name="l01386"></a>01386     }
<a name="l01387"></a>01387 
<a name="l01389"></a><a class="code" href="classhdnum_1_1DIRK.html#a374aa0f371c2fc1d0b0dd64610629c08">01389</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1DIRK.html#a374aa0f371c2fc1d0b0dd64610629c08" title="do one step">step</a> ()
<a name="l01390"></a>01390     {
<a name="l01391"></a>01391 
<a name="l01392"></a>01392       <span class="keyword">const</span> <a class="code" href="classhdnum_1_1DIRK.html#a80ab2ad1360bc6061cea64d7a5ca9d12" title="export size_type">size_type</a> R = butcher.colsize()-1;
<a name="l01393"></a>01393 
<a name="l01394"></a>01394       <span class="keywordtype">bool</span> reduced = <span class="keyword">false</span>;
<a name="l01395"></a>01395       error = <span class="keyword">false</span>;
<a name="l01396"></a>01396       <span class="keywordflow">if</span>(verbosity&gt;=2)
<a name="l01397"></a>01397         std::cout &lt;&lt; <span class="stringliteral">&quot;DIRK: step to&quot;</span> &lt;&lt; <span class="stringliteral">&quot; t+dt=&quot;</span> &lt;&lt; t+dt &lt;&lt; <span class="stringliteral">&quot; dt=&quot;</span> &lt;&lt; dt &lt;&lt; std::endl;
<a name="l01398"></a>01398 
<a name="l01399"></a>01399       <span class="keywordflow">while</span> (1)
<a name="l01400"></a>01400         {
<a name="l01401"></a>01401           <span class="keywordtype">bool</span> converged = <span class="keyword">true</span>;
<a name="l01402"></a>01402 
<a name="l01403"></a>01403           <span class="comment">// Perform R Runge-Kutta steps</span>
<a name="l01404"></a>01404           std::vector&lt; Vector&lt;number_type&gt; &gt; k;
<a name="l01405"></a>01405           <span class="keywordflow">for</span>(<a class="code" href="classhdnum_1_1DIRK.html#a80ab2ad1360bc6061cea64d7a5ca9d12" title="export size_type">size_type</a> i=0; i&lt;R; ++i) {
<a name="l01406"></a>01406             <span class="keywordflow">if</span> (verbosity&gt;=2) 
<a name="l01407"></a>01407               std::cout &lt;&lt; <span class="stringliteral">&quot;DIRK: step nr &quot;</span>&lt;&lt; i &lt;&lt; std::endl;
<a name="l01408"></a>01408 
<a name="l01409"></a>01409             <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> current_z(model.size(),0.0);
<a name="l01410"></a>01410 
<a name="l01411"></a>01411             <span class="comment">// Set starting value of k_i</span>
<a name="l01412"></a>01412             <span class="comment">// model.f(t,u,current_k);</span>
<a name="l01413"></a>01413 
<a name="l01414"></a>01414             <span class="comment">// Solve nonlinear problem</span>
<a name="l01415"></a>01415             NonlinearProblem nlp(model,u,t,dt,butcher,i,k);
<a name="l01416"></a>01416 
<a name="l01417"></a>01417             newton.solve(nlp,current_z);
<a name="l01418"></a>01418 
<a name="l01419"></a>01419             converged = converged &amp;&amp; newton.has_converged();
<a name="l01420"></a>01420             <span class="keywordflow">if</span>(!converged)
<a name="l01421"></a>01421               <span class="keywordflow">break</span>;
<a name="l01422"></a>01422 
<a name="l01423"></a>01423             current_z.update(1., u);
<a name="l01424"></a>01424             <span class="keyword">const</span> <a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183" title="export number_type">number_type</a> t_i = t + butcher[i][0] * dt;
<a name="l01425"></a>01425             <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>current_k(model.size(),0.);
<a name="l01426"></a>01426             model.f(t_i,current_z,current_k);
<a name="l01427"></a>01427 
<a name="l01428"></a>01428             k.push_back( current_k );
<a name="l01429"></a>01429           }
<a name="l01430"></a>01430 
<a name="l01431"></a>01431           <span class="keywordflow">if</span> (converged)
<a name="l01432"></a>01432             {
<a name="l01433"></a>01433               <span class="keywordflow">if</span>(verbosity &gt;= 2)
<a name="l01434"></a>01434                 std::cout &lt;&lt; <span class="stringliteral">&quot;DIRK finished&quot;</span>&lt;&lt; std::endl;
<a name="l01435"></a>01435               
<a name="l01436"></a>01436               <span class="comment">// Update to new solution</span>
<a name="l01437"></a>01437               <span class="keywordflow">for</span>(<a class="code" href="classhdnum_1_1DIRK.html#a80ab2ad1360bc6061cea64d7a5ca9d12" title="export size_type">size_type</a> i=0; i&lt;R; ++i)
<a name="l01438"></a>01438                 u.update(dt*butcher[R][1+i],k[i]);
<a name="l01439"></a>01439 
<a name="l01440"></a>01440               t += dt;
<a name="l01441"></a>01441               <span class="keywordflow">if</span> (!reduced &amp;&amp; dt&lt;dtmax-1e-13)
<a name="l01442"></a>01442                 {
<a name="l01443"></a>01443                   dt = std::min(2.0*dt,dtmax);
<a name="l01444"></a>01444                   <span class="keywordflow">if</span> (verbosity&gt;0) 
<a name="l01445"></a>01445                     std::cout &lt;&lt; <span class="stringliteral">&quot;DIRK: increasing time step to &quot;</span> &lt;&lt; dt &lt;&lt; std::endl;
<a name="l01446"></a>01446                 }
<a name="l01447"></a>01447               <span class="keywordflow">return</span>;
<a name="l01448"></a>01448             }
<a name="l01449"></a>01449           <span class="keywordflow">else</span>
<a name="l01450"></a>01450             {
<a name="l01451"></a>01451               <span class="keywordflow">if</span> (dt&lt;1e-12)
<a name="l01452"></a>01452                 {
<a name="l01453"></a>01453                   HDNUM_ERROR(<span class="stringliteral">&quot;time step too small in implicit Euler&quot;</span>);
<a name="l01454"></a>01454                   error = <span class="keyword">true</span>;
<a name="l01455"></a>01455                   <span class="keywordflow">break</span>;
<a name="l01456"></a>01456                 }
<a name="l01457"></a>01457               dt *= 0.5;
<a name="l01458"></a>01458               reduced = <span class="keyword">true</span>;
<a name="l01459"></a>01459               <span class="keywordflow">if</span> (verbosity&gt;0) std::cout &lt;&lt; <span class="stringliteral">&quot;DIRK: reducing time step to &quot;</span> &lt;&lt; dt &lt;&lt; std::endl;
<a name="l01460"></a>01460             }
<a name="l01461"></a>01461         }
<a name="l01462"></a>01462     }
<a name="l01463"></a>01463 
<a name="l01465"></a><a class="code" href="classhdnum_1_1DIRK.html#aa4b8eff08392d8860fc21a0d4128214e">01465</a>     <span class="keywordtype">bool</span> <a class="code" href="classhdnum_1_1DIRK.html#aa4b8eff08392d8860fc21a0d4128214e" title="get current state">get_error</a> ()<span class="keyword"> const</span>
<a name="l01466"></a>01466 <span class="keyword">    </span>{
<a name="l01467"></a>01467       <span class="keywordflow">return</span> error;
<a name="l01468"></a>01468     }
<a name="l01469"></a>01469 
<a name="l01471"></a><a class="code" href="classhdnum_1_1DIRK.html#a669ef1d303de0ca56bf76f5a19d56547">01471</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1DIRK.html#a669ef1d303de0ca56bf76f5a19d56547" title="set current state">set_state</a> (<a class="code" href="classhdnum_1_1DIRK.html#a91204fa2e007b5eed35034bfe409037b" title="export time_type">time_type</a> t_, <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; u_)
<a name="l01472"></a>01472     {
<a name="l01473"></a>01473       t = t_;
<a name="l01474"></a>01474       u = u_;
<a name="l01475"></a>01475     }
<a name="l01476"></a>01476 
<a name="l01478"></a><a class="code" href="classhdnum_1_1DIRK.html#a80c4b9b62cde9e0aeed6cc483d2f697f">01478</a>     <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a>&amp; <a class="code" href="classhdnum_1_1DIRK.html#a80c4b9b62cde9e0aeed6cc483d2f697f" title="get current state">get_state</a> ()<span class="keyword"> const</span>
<a name="l01479"></a>01479 <span class="keyword">    </span>{
<a name="l01480"></a>01480       <span class="keywordflow">return</span> u;
<a name="l01481"></a>01481     }
<a name="l01482"></a>01482 
<a name="l01484"></a><a class="code" href="classhdnum_1_1DIRK.html#a2291c2a6d41a17beca34aa2015d27047">01484</a>     <a class="code" href="classhdnum_1_1DIRK.html#a91204fa2e007b5eed35034bfe409037b" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1DIRK.html#a2291c2a6d41a17beca34aa2015d27047" title="get current time">get_time</a> ()<span class="keyword"> const</span>
<a name="l01485"></a>01485 <span class="keyword">    </span>{
<a name="l01486"></a>01486       <span class="keywordflow">return</span> t;
<a name="l01487"></a>01487     }
<a name="l01488"></a>01488 
<a name="l01490"></a><a class="code" href="classhdnum_1_1DIRK.html#aa5e8c88d9d8643d1d69597ec6acc9a86">01490</a>     <a class="code" href="classhdnum_1_1DIRK.html#a91204fa2e007b5eed35034bfe409037b" title="export time_type">time_type</a> <a class="code" href="classhdnum_1_1DIRK.html#aa5e8c88d9d8643d1d69597ec6acc9a86" title="get dt used in last step (i.e. to compute current state)">get_dt</a> ()<span class="keyword"> const</span>
<a name="l01491"></a>01491 <span class="keyword">    </span>{
<a name="l01492"></a>01492       <span class="keywordflow">return</span> dt;
<a name="l01493"></a>01493     }
<a name="l01494"></a>01494 
<a name="l01496"></a><a class="code" href="classhdnum_1_1DIRK.html#aac3e58f4d2aba39e126fc26b4bc209c4">01496</a>     <a class="code" href="classhdnum_1_1DIRK.html#a80ab2ad1360bc6061cea64d7a5ca9d12" title="export size_type">size_type</a> <a class="code" href="classhdnum_1_1DIRK.html#aac3e58f4d2aba39e126fc26b4bc209c4" title="return consistency order of the method">get_order</a> ()<span class="keyword"> const</span>
<a name="l01497"></a>01497 <span class="keyword">    </span>{
<a name="l01498"></a>01498       <span class="keywordflow">return</span> order;
<a name="l01499"></a>01499     }
<a name="l01500"></a>01500     
<a name="l01502"></a><a class="code" href="classhdnum_1_1DIRK.html#acea50784ed18f24bce76ad0c9a48a4d6">01502</a>     <span class="keywordtype">void</span> <a class="code" href="classhdnum_1_1DIRK.html#acea50784ed18f24bce76ad0c9a48a4d6" title="print some information">get_info</a> ()<span class="keyword"> const</span>
<a name="l01503"></a>01503 <span class="keyword">    </span>{
<a name="l01504"></a>01504     }
<a name="l01505"></a>01505 
<a name="l01506"></a>01506   <span class="keyword">private</span>:
<a name="l01507"></a>01507     <a class="code" href="classhdnum_1_1DIRK.html#a80ab2ad1360bc6061cea64d7a5ca9d12" title="export size_type">size_type</a> verbosity;
<a name="l01508"></a>01508     <span class="keyword">const</span> <a class="code" href="classhdnum_1_1Matrix.html">Matrix&lt;number_type&gt;</a> butcher; 
<a name="l01509"></a>01509     <span class="keyword">const</span> M&amp; model;
<a name="l01510"></a>01510     <span class="keyword">const</span> S&amp; newton;
<a name="l01511"></a>01511     <a class="code" href="classhdnum_1_1DIRK.html#a91204fa2e007b5eed35034bfe409037b" title="export time_type">time_type</a> t, dt, dtmax;
<a name="l01512"></a>01512     <a class="code" href="classhdnum_1_1DIRK.html#a287d241d2d7cc622d8688bd062b73183" title="export number_type">number_type</a> reduction;
<a name="l01513"></a>01513     <a class="code" href="classhdnum_1_1DIRK.html#a80ab2ad1360bc6061cea64d7a5ca9d12" title="export size_type">size_type</a> linesearchsteps;
<a name="l01514"></a>01514     <a class="code" href="classhdnum_1_1Vector.html">Vector&lt;number_type&gt;</a> u;
<a name="l01515"></a>01515     <span class="keywordtype">int</span> order;
<a name="l01516"></a>01516     <span class="keyword">mutable</span> <span class="keywordtype">bool</span> error;
<a name="l01517"></a>01517   };
<a name="l01518"></a>01518 
<a name="l01520"></a>01520   <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keyword">class</span> N&gt;
<a name="l01521"></a>01521   <span class="keyword">inline</span> <span class="keywordtype">void</span> gnuplot (<span class="keyword">const</span> std::string&amp; fname, <span class="keyword">const</span> std::vector&lt;T&gt; t, <span class="keyword">const</span> std::vector&lt;Vector&lt;N&gt; &gt; u)
<a name="l01522"></a>01522   {
<a name="l01523"></a>01523     std::fstream f(fname.c_str(),std::ios::out);
<a name="l01524"></a>01524     <span class="keywordflow">for</span> (<span class="keyword">typename</span> std::vector&lt;T&gt;::size_type n=0; n&lt;t.size(); n++)
<a name="l01525"></a>01525       {
<a name="l01526"></a>01526         f &lt;&lt; std::scientific &lt;&lt; std::showpoint 
<a name="l01527"></a>01527           &lt;&lt; std::setprecision(16) &lt;&lt; t[n];
<a name="l01528"></a>01528         <span class="keywordflow">for</span> (<span class="keyword">typename</span> Vector&lt;N&gt;::size_type i=0; i&lt;u[n].size(); i++)
<a name="l01529"></a>01529           f &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::scientific &lt;&lt; std::showpoint 
<a name="l01530"></a>01530             &lt;&lt; std::setprecision(u[n].precision()) &lt;&lt; u[n][i];
<a name="l01531"></a>01531         f &lt;&lt; std::endl;
<a name="l01532"></a>01532       }
<a name="l01533"></a>01533     f.close();
<a name="l01534"></a>01534   }
<a name="l01535"></a>01535 
<a name="l01537"></a>01537   <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keyword">class</span> N&gt;
<a name="l01538"></a>01538   <span class="keyword">inline</span> <span class="keywordtype">void</span> gnuplot (<span class="keyword">const</span> std::string&amp; fname, <span class="keyword">const</span> std::vector&lt;T&gt; t, <span class="keyword">const</span> std::vector&lt;Vector&lt;N&gt; &gt; u, <span class="keyword">const</span> std::vector&lt;T&gt; dt)
<a name="l01539"></a>01539   {
<a name="l01540"></a>01540     std::fstream f(fname.c_str(),std::ios::out);
<a name="l01541"></a>01541     <span class="keywordflow">for</span> (<span class="keyword">typename</span> std::vector&lt;T&gt;::size_type n=0; n&lt;t.size(); n++)
<a name="l01542"></a>01542       {
<a name="l01543"></a>01543         f &lt;&lt; std::scientific &lt;&lt; std::showpoint 
<a name="l01544"></a>01544           &lt;&lt; std::setprecision(16) &lt;&lt; t[n];
<a name="l01545"></a>01545         <span class="keywordflow">for</span> (<span class="keyword">typename</span> Vector&lt;N&gt;::size_type i=0; i&lt;u[n].size(); i++)
<a name="l01546"></a>01546           f &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::scientific &lt;&lt; std::showpoint 
<a name="l01547"></a>01547             &lt;&lt; std::setprecision(u[n].precision()) &lt;&lt; u[n][i];
<a name="l01548"></a>01548         f &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; std::scientific &lt;&lt; std::showpoint 
<a name="l01549"></a>01549           &lt;&lt; std::setprecision(16) &lt;&lt; dt[n];
<a name="l01550"></a>01550         f &lt;&lt; std::endl;
<a name="l01551"></a>01551       }
<a name="l01552"></a>01552     f.close();
<a name="l01553"></a>01553   }
<a name="l01554"></a>01554 
<a name="l01555"></a>01555 } <span class="comment">// namespace hdnum</span>
<a name="l01556"></a>01556 
<a name="l01557"></a>01557 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Aug 30 15:55:38 2011 for Heidelberg Educational Numerics Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
